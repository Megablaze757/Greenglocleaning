<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Admin Panel | GreenGlo Cleaners</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <style>
        /* ===== CSS Reset & Variables ===== */
        :root {
            --primary-green: #10B981;
            --secondary-green: #34D399;
            --dark-green: #065F46;
            --light-green: #D1FAE5;
            --accent-green: #059669;
            --emerald: #10B981;
            --teal: #0D9488;
            --mint: #A7F3D0;
            --white: #FFFFFF;
            --off-white: #F9FAFB;
            --light-gray: #F3F4F6;
            --medium-gray: #9CA3AF;
            --dark-gray: #4B5563;
            --black: #111827;
            --gold: #FBBF24;
            --red: #EF4444;
            --orange: #F59E0B;
            --blue: #3B82F6;
            --purple: #8B5CF6;
            --shadow: 0 20px 40px rgba(16, 185, 129, 0.12);
            --shadow-lg: 0 25px 50px rgba(16, 185, 129, 0.15);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 16px;
            --border-radius-lg: 24px;
            --gradient-primary: linear-gradient(135deg, var(--primary-green), var(--teal));
            --gradient-dark: linear-gradient(135deg, var(--dark-green), var(--teal));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            line-height: 1.7;
            color: var(--dark-gray);
            background-color: var(--off-white);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            line-height: 1.2;
            color: var(--dark-green);
            letter-spacing: -0.5px;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* ===== Admin Layout ===== */
        .admin-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        /* ===== Admin Sidebar ===== */
        .admin-sidebar {
            background: var(--dark-green);
            color: var(--white);
            padding: 2rem 1.5rem;
            position: fixed;
            width: 280px;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 3rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-logo img {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--gradient-primary);
            padding: 0.5rem;
        }

        .admin-logo h2 {
            color: var(--white);
            font-size: 1.5rem;
        }

        .admin-logo span {
            font-size: 0.75rem;
            color: var(--light-green);
            opacity: 0.8;
        }

        .admin-nav {
            margin-bottom: 3rem;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section h3 {
            color: var(--light-green);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            padding-left: 1rem;
        }

        .nav-links {
            list-style: none;
        }

        .nav-links li {
            margin-bottom: 0.5rem;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 12px;
            transition: var(--transition);
        }

        .nav-links a:hover,
        .nav-links a.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }

        .nav-links a i {
            width: 20px;
            text-align: center;
        }

        .admin-stats {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: auto;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
        }

        .stat-value {
            color: var(--white);
            font-weight: 600;
            font-size: 1.125rem;
        }

        /* ===== Admin Main Content ===== */
        .admin-main {
            grid-column: 2;
            padding: 2rem;
            background: var(--off-white);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }

        .admin-header h1 {
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .admin-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            background: var(--gradient-primary);
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            gap: 0.5rem;
            min-height: 48px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-green);
            color: var(--primary-green);
        }

        .btn-outline:hover {
            background: var(--primary-green);
            color: var(--white);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            min-height: 36px;
        }

        .btn-red {
            background: var(--red);
        }

        .btn-orange {
            background: var(--orange);
        }

        .btn-blue {
            background: var(--blue);
        }

        .btn-purple {
            background: var(--purple);
        }

        /* ===== Dashboard Stats ===== */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--white);
        }

        .icon-green {
            background: var(--gradient-primary);
        }

        .icon-orange {
            background: linear-gradient(135deg, var(--orange), #F97316);
        }

        .icon-blue {
            background: linear-gradient(135deg, var(--blue), #1D4ED8);
        }

        .icon-purple {
            background: linear-gradient(135deg, var(--purple), #7C3AED);
        }

        .stat-content h3 {
            font-size: 2rem;
            margin-bottom: 0.25rem;
        }

        .stat-content p {
            color: var(--medium-gray);
            font-size: 0.875rem;
        }

        /* ===== Admin Tables ===== */
        .admin-table-container {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }

        .table-header h3 {
            margin: 0;
            font-size: 1.25rem;
        }

        .table-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-box {
            position: relative;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid var(--light-gray);
            border-radius: 12px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9375rem;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--medium-gray);
        }

        .filter-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .filter-select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--light-gray);
            border-radius: 12px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9375rem;
            background: var(--white);
            color: var(--dark-gray);
            cursor: pointer;
            min-width: 150px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }

        .admin-table th {
            background: var(--off-white);
            padding: 1rem 1.5rem;
            text-align: left;
            font-weight: 600;
            color: var(--dark-gray);
            border-bottom: 1px solid var(--light-gray);
            white-space: nowrap;
        }

        .admin-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            vertical-align: middle;
        }

        .admin-table tr:hover {
            background: var(--off-white);
        }

        .admin-table tr:last-child td {
            border-bottom: none;
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--orange);
        }

        .status-confirmed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary-green);
        }

        .status-completed {
            background: rgba(59, 130, 246, 0.1);
            color: var(--blue);
        }

        .status-cancelled {
            background: rgba(239, 68, 68, 0.1);
            color: var(--red);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: var(--light-gray);
            color: var(--dark-gray);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .action-btn.view {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary-green);
        }

        .action-btn.edit {
            background: rgba(59, 130, 246, 0.1);
            color: var(--blue);
        }

        .action-btn.delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--red);
        }

        /* ===== Modal Styles ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: var(--transition);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--medium-gray);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--light-gray);
            color: var(--dark-gray);
        }

        .modal-content {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* ===== Form Styles ===== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-gray);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--light-gray);
            border-radius: 12px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-divider {
            height: 1px;
            background: var(--light-gray);
            margin: 2rem 0;
        }

        .form-section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--dark-green);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* ===== Booking Details ===== */
        .booking-details {
            display: grid;
            gap: 1.5rem;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--light-gray);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: var(--medium-gray);
            font-weight: 500;
        }

        .detail-value {
            font-weight: 600;
            color: var(--dark-gray);
            text-align: right;
        }

        .detail-value.badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
        }

        /* ===== Calendar Styles ===== */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem 1.5rem;
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .calendar-nav button {
            background: var(--light-gray);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-nav button:hover {
            background: var(--primary-green);
            color: var(--white);
        }

        .calendar-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark-green);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .calendar-day-header {
            background: var(--off-white);
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            color: var(--dark-gray);
            border-bottom: 1px solid var(--light-gray);
        }

        .calendar-day {
            background: var(--white);
            min-height: 120px;
            padding: 0.5rem;
            border: 1px solid var(--light-gray);
        }

        .calendar-day.other-month {
            background: var(--off-white);
            color: var(--medium-gray);
        }

        .calendar-day.today {
            background: var(--light-green);
            border: 2px solid var(--primary-green);
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 0.5rem;
            padding: 0.25rem;
            border-radius: 4px;
        }

        .calendar-slots {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-height: 80px;
            overflow-y: auto;
        }

        .slot-item {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .slot-available {
            background: var(--light-green);
            color: var(--dark-green);
        }

        .slot-booked {
            background: var(--light-gray);
            color: var(--dark-gray);
        }

        .slot-blocked {
            background: #FEE2E2;
            color: #991B1B;
        }

        .day-availability {
            font-size: 0.75rem;
            color: var(--medium-gray);
            margin-top: 0.5rem;
        }

        /* ===== Loading Spinner ===== */
        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--medium-gray);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--light-gray);
            border-radius: 50%;
            border-top-color: var(--primary-green);
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== No Data Message ===== */
        .no-data {
            text-align: center;
            padding: 3rem;
            color: var(--medium-gray);
        }

        .no-data i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--light-gray);
        }

        /* ===== Pagination ===== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            padding: 1.5rem;
            border-top: 1px solid var(--light-gray);
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            background: var(--white);
            color: var(--dark-gray);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .page-btn:hover:not(:disabled) {
            border-color: var(--primary-green);
            color: var(--primary-green);
        }

        .page-btn.active {
            background: var(--gradient-primary);
            border-color: var(--primary-green);
            color: var(--white);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== Responsive Design ===== */
        @media (max-width: 1200px) {
            .admin-container {
                grid-template-columns: 1fr;
            }

            .admin-sidebar {
                position: fixed;
                left: -280px;
                transition: var(--transition);
                z-index: 1000;
            }

            .admin-sidebar.active {
                left: 0;
            }

            .admin-main {
                grid-column: 1;
                margin-left: 0;
            }

            .mobile-menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 48px;
                height: 48px;
                background: var(--light-green);
                border-radius: 12px;
                border: none;
                cursor: pointer;
                color: var(--primary-green);
                font-size: 1.25rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }

            .admin-main {
                padding: 1rem;
            }

            .dashboard-stats {
                grid-template-columns: 1fr;
            }

            .table-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .search-box {
                min-width: 100%;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .admin-table {
                display: block;
                overflow-x: auto;
            }

            .action-buttons {
                flex-wrap: wrap;
            }

            .calendar-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .admin-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .modal {
                width: 95%;
            }

            .calendar-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Admin Container -->
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar" id="sidebar">
            <div class="admin-logo">
                <img src="logo.png" alt="GreenGlo Logo">
                <div>
                    <h2>GreenGlo</h2>
                    <span>Admin Panel</span>
                </div>
            </div>

            <nav class="admin-nav">
                <div class="nav-section">
                    <h3>Main</h3>
                    <ul class="nav-links">
                        <li><a href="#dashboard" class="active" id="navDashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            Dashboard
                        </a></li>
                        <li><a href="#bookings" id="navBookings">
                            <i class="fas fa-calendar-check"></i>
                            Bookings
                        </a></li>
                        <li><a href="#availability" id="navAvailability">
                            <i class="fas fa-calendar-alt"></i>
                            Availability
                        </a></li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h3>Management</h3>
                    <ul class="nav-links">
                        <li><a href="#customers" id="navCustomers">
                            <i class="fas fa-users"></i>
                            Customers
                        </a></li>
                        <li><a href="#services" id="navServices">
                            <i class="fas fa-spray-can-sparkles"></i>
                            Services
                        </a></li>
                        <li><a href="#reports" id="navReports">
                            <i class="fas fa-chart-bar"></i>
                            Reports
                        </a></li>
                    </ul>
                </div>

                <div class="nav-section">
                    <h3>Settings</h3>
                    <ul class="nav-links">
                        <li><a href="#settings" id="navSettings">
                            <i class="fas fa-cog"></i>
                            Settings
                        </a></li>
                        <li><a href="index.html" target="_blank">
                            <i class="fas fa-external-link-alt"></i>
                            View Site
                        </a></li>
                    </ul>
                </div>
            </nav>

            <div class="admin-stats" id="sidebarStats">
                <div class="stat-item">
                    <span class="stat-label">Today</span>
                    <span class="stat-value" id="statToday">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">This Week</span>
                    <span class="stat-value" id="statWeek">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Revenue</span>
                    <span class="stat-value" id="statRevenue">£0</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Header -->
            <header class="admin-header">
                <div>
                    <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
                    <p id="currentDate" style="color: var(--medium-gray); margin-top: 0.5rem;"></p>
                </div>
                <div class="admin-actions">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <button class="btn btn-outline" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                    <button class="btn" id="newBookingBtn">
                        <i class="fas fa-plus"></i>
                        New Booking
                    </button>
                </div>
            </header>

            <!-- Dashboard Stats -->
            <section id="dashboardSection">
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon icon-green">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalBookings">0</h3>
                            <p>Total Bookings</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon icon-orange">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="pendingBookings">0</h3>
                            <p>Pending</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon icon-blue">
                            <i class="fas fa-pound-sign"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalRevenue">£0</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon icon-purple">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeCustomers">0</h3>
                            <p>Active Customers</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Bookings -->
                <div class="admin-table-container">
                    <div class="table-header">
                        <h3>Recent Bookings</h3>
                        <div class="table-actions">
                            <div class="filter-group">
                                <select class="filter-select" id="recentFilter">
                                    <option value="7">Last 7 days</option>
                                    <option value="30">Last 30 days</option>
                                    <option value="90">Last 90 days</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table class="admin-table" id="recentBookingsTable">
                            <thead>
                                <tr>
                                    <th>Booking ID</th>
                                    <th>Date & Time</th>
                                    <th>Customer</th>
                                    <th>Service</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentBookingsBody">
                                <!-- Data loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="no-data" id="recentNoData" style="display: none;">
                        <i class="fas fa-calendar-times"></i>
                        <p>No recent bookings found</p>
                    </div>
                    <div class="loading-spinner" id="recentLoading">
                        <div class="spinner"></div>
                        <p>Loading recent bookings...</p>
                    </div>
                </div>
            </section>

            <!-- Bookings Management Section -->
            <section id="bookingsSection" style="display: none;">
                <div class="admin-table-container">
                    <div class="table-header">
                        <h3>All Bookings</h3>
                        <div class="table-actions">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="bookingSearch" placeholder="Search bookings...">
                            </div>
                            <div class="filter-group">
                                <select class="filter-select" id="statusFilter">
                                    <option value="all">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="confirmed">Confirmed</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <select class="filter-select" id="dateFilter">
                                    <option value="all">All Dates</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table class="admin-table" id="bookingsTable">
                            <thead>
                                <tr>
                                    <th>Booking ID</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Customer</th>
                                    <th>Service</th>
                                    <th>Duration</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookingsBody">
                                <!-- Data loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="no-data" id="bookingsNoData" style="display: none;">
                        <i class="fas fa-calendar-times"></i>
                        <p>No bookings found</p>
                    </div>
                    <div class="loading-spinner" id="bookingsLoading">
                        <div class="spinner"></div>
                        <p>Loading bookings...</p>
                    </div>
                    <div class="pagination" id="bookingsPagination">
                        <!-- Pagination buttons -->
                    </div>
                </div>
            </section>

            <!-- Availability Management Section -->
            <section id="availabilitySection" style="display: none;">
                <div class="admin-table-container">
                    <div class="table-header">
                        <h3>Availability Calendar</h3>
                        <div class="table-actions">
                            <button class="btn btn-small" id="addSlotsBtn">
                                <i class="fas fa-plus"></i>
                                Add Time Slots
                            </button>
                            <button class="btn btn-small btn-blue" id="setWorkingHoursBtn">
                                <i class="fas fa-clock"></i>
                                Set Working Hours
                            </button>
                            <button class="btn btn-small btn-orange" id="bulkBlockBtn">
                                <i class="fas fa-ban"></i>
                                Bulk Block
                            </button>
                        </div>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div class="calendar-header">
                            <div class="calendar-nav">
                                <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                                <div class="calendar-title" id="calendarTitle">January 2024</div>
                                <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <div style="display: flex; align-items: center; gap: 0.25rem;">
                                    <div style="width: 12px; height: 12px; background: var(--light-green); border-radius: 2px;"></div>
                                    <small>Available</small>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.25rem;">
                                    <div style="width: 12px; height: 12px; background: var(--light-gray); border-radius: 2px;"></div>
                                    <small>Booked</small>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.25rem;">
                                    <div style="width: 12px; height: 12px; background: #FEE2E2; border-radius: 2px;"></div>
                                    <small>Blocked</small>
                                </div>
                            </div>
                        </div>
                        <div class="calendar-grid" id="availabilityCalendar">
                            <!-- Calendar will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Booking Details Modal -->
    <div class="modal-overlay" id="bookingDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Booking Details</h3>
                <button class="modal-close" id="closeDetailsModal">×</button>
            </div>
            <div class="modal-content">
                <div class="booking-details" id="bookingDetailsContent">
                    <!-- Details loaded via JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeDetailsBtn">Close</button>
                <button class="btn btn-blue" id="editBookingBtn">Edit</button>
                <button class="btn btn-red" id="cancelBookingBtn">Cancel Booking</button>
            </div>
        </div>
    </div>

    <!-- Edit Booking Modal -->
    <div class="modal-overlay" id="editBookingModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Edit Booking</h3>
                <button class="modal-close" id="closeEditModal">×</button>
            </div>
            <div class="modal-content">
                <form id="editBookingForm">
                    <div class="form-section-title">
                        <i class="fas fa-calendar"></i>
                        Booking Information
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editDate">Date *</label>
                            <input type="date" id="editDate" required>
                        </div>
                        <div class="form-group">
                            <label for="editTime">Time *</label>
                            <select id="editTime" required>
                                <option value="">Select Time</option>
                                <option value="09:00">09:00 AM</option>
                                <option value="10:00">10:00 AM</option>
                                <option value="11:00">11:00 AM</option>
                                <option value="12:00">12:00 PM</option>
                                <option value="13:00">01:00 PM</option>
                                <option value="14:00">02:00 PM</option>
                                <option value="15:00">03:00 PM</option>
                                <option value="16:00">04:00 PM</option>
                                <option value="17:00">05:00 PM</option>
                                <option value="18:00">06:00 PM</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editServiceType">Service Type *</label>
                            <select id="editServiceType" required>
                                <option value="regular">Regular Cleaning (£18/hour)</option>
                                <option value="deep">Deep Cleaning (£25/hour)</option>
                                <option value="end_tenancy">End of Tenancy (£30/hour)</option>
                                <option value="carpet">Carpet Cleaning (£25/room)</option>
                                <option value="oven">Oven Cleaning (£45 fixed)</option>
                                <option value="office">Office Cleaning (£0.5/m²)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editDuration">Duration *</label>
                            <select id="editDuration" required>
                                <option value="2">2 hours</option>
                                <option value="3">3 hours</option>
                                <option value="4">4 hours</option>
                                <option value="6">6 hours</option>
                                <option value="8">Full day (8 hours)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-user"></i>
                        Customer Information
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCustomerName">Full Name *</label>
                            <input type="text" id="editCustomerName" required>
                        </div>
                        <div class="form-group">
                            <label for="editCustomerPhone">Phone *</label>
                            <input type="tel" id="editCustomerPhone" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCustomerEmail">Email</label>
                            <input type="email" id="editCustomerEmail">
                        </div>
                        <div class="form-group">
                            <label for="editStatus">Status *</label>
                            <select id="editStatus" required>
                                <option value="pending">Pending</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editAddress">Address *</label>
                        <textarea id="editAddress" rows="2" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editInstructions">Special Instructions</label>
                        <textarea id="editInstructions" rows="2"></textarea>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-pound-sign"></i>
                        Pricing
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editPrice">Price (£)</label>
                            <input type="number" id="editPrice" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="editAmountPaid">Amount Paid (£)</label>
                            <input type="number" id="editAmountPaid" step="0.01" min="0">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelEditBtn">Cancel</button>
                <button class="btn" id="saveBookingBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- New Booking Modal -->
    <div class="modal-overlay" id="newBookingModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Create New Booking</h3>
                <button class="modal-close" id="closeNewModal">×</button>
            </div>
            <div class="modal-content">
                <form id="newBookingForm">
                    <div class="form-section-title">
                        <i class="fas fa-calendar"></i>
                        Booking Information
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newDate">Date *</label>
                            <input type="date" id="newDate" required>
                        </div>
                        <div class="form-group">
                            <label for="newTime">Time *</label>
                            <select id="newTime" required>
                                <option value="">Select Time</option>
                                <option value="09:00">09:00 AM</option>
                                <option value="10:00">10:00 AM</option>
                                <option value="11:00">11:00 AM</option>
                                <option value="12:00">12:00 PM</option>
                                <option value="13:00">01:00 PM</option>
                                <option value="14:00">02:00 PM</option>
                                <option value="15:00">03:00 PM</option>
                                <option value="16:00">04:00 PM</option>
                                <option value="17:00">05:00 PM</option>
                                <option value="18:00">06:00 PM</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newServiceType">Service Type *</label>
                            <select id="newServiceType" required>
                                <option value="regular">Regular Cleaning (£18/hour)</option>
                                <option value="deep">Deep Cleaning (£25/hour)</option>
                                <option value="end_tenancy">End of Tenancy (£30/hour)</option>
                                <option value="carpet">Carpet Cleaning (£25/room)</option>
                                <option value="oven">Oven Cleaning (£45 fixed)</option>
                                <option value="office">Office Cleaning (£0.5/m²)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="newDuration">Duration *</label>
                            <select id="newDuration" required>
                                <option value="2">2 hours</option>
                                <option value="3">3 hours</option>
                                <option value="4">4 hours</option>
                                <option value="6">6 hours</option>
                                <option value="8">Full day (8 hours)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-user"></i>
                        Customer Information
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newCustomerName">Full Name *</label>
                            <input type="text" id="newCustomerName" required>
                        </div>
                        <div class="form-group">
                            <label for="newCustomerPhone">Phone *</label>
                            <input type="tel" id="newCustomerPhone" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newCustomerEmail">Email</label>
                            <input type="email" id="newCustomerEmail">
                        </div>
                        <div class="form-group">
                            <label for="newStatus">Status *</label>
                            <select id="newStatus" required>
                                <option value="pending">Pending</option>
                                <option value="confirmed" selected>Confirmed</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newAddress">Address *</label>
                        <textarea id="newAddress" rows="2" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newInstructions">Special Instructions</label>
                        <textarea id="newInstructions" rows="2"></textarea>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-pound-sign"></i>
                        Pricing
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newPrice">Price (£)</label>
                            <input type="number" id="newPrice" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="newAmountPaid">Amount Paid (£)</label>
                            <input type="number" id="newAmountPaid" step="0.01" min="0" value="0">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelNewBtn">Cancel</button>
                <button class="btn" id="createBookingBtn">Create Booking</button>
            </div>
        </div>
    </div>

    <!-- Add Time Slots Modal -->
    <div class="modal-overlay" id="addSlotsModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Add Time Slots</h3>
                <button class="modal-close" id="closeAddSlotsModal">×</button>
            </div>
            <div class="modal-content">
                <form id="addSlotsForm">
                    <div class="form-section-title">
                        <i class="fas fa-calendar"></i>
                        Date Range
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="slotStartDate">Start Date *</label>
                            <input type="date" id="slotStartDate" required>
                        </div>
                        <div class="form-group">
                            <label for="slotEndDate">End Date *</label>
                            <input type="date" id="slotEndDate" required>
                        </div>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-clock"></i>
                        Time Slots
                    </div>
                    <div class="form-group">
                        <label>Select Time Slots *</label>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="09:00">
                                09:00 AM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="10:00">
                                10:00 AM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="11:00">
                                11:00 AM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="12:00">
                                12:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="13:00">
                                01:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="14:00">
                                02:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="15:00">
                                03:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="16:00">
                                04:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="17:00">
                                05:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-time" value="18:00">
                                06:00 PM
                            </label>
                        </div>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-calendar-day"></i>
                        Days of Week
                    </div>
                    <div class="form-group">
                        <label>Repeat On</label>
                        <div style="display: flex; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-day" value="0">
                                Monday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-day" value="1">
                                Tuesday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-day" value="2">
                                Wednesday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-day" value="3">
                                Thursday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-day" value="4">
                                Friday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-day" value="5">
                                Saturday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="slot-day" value="6">
                                Sunday
                            </label>
                        </div>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-cog"></i>
                        Settings
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="slotType">Slot Type</label>
                            <select id="slotType">
                                <option value="available">Available for booking</option>
                                <option value="blocked">Blocked (not available)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="maxBookings">Max Bookings per Slot</label>
                            <input type="number" id="maxBookings" min="1" value="1">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelAddSlotsBtn">Cancel</button>
                <button class="btn" id="saveSlotsBtn">Add Time Slots</button>
            </div>
        </div>
    </div>

    <!-- Working Hours Modal -->
    <div class="modal-overlay" id="workingHoursModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Set Working Hours</h3>
                <button class="modal-close" id="closeWorkingHoursModal">×</button>
            </div>
            <div class="modal-content">
                <form id="workingHoursForm">
                    <div class="form-section-title">
                        <i class="fas fa-calendar-alt"></i>
                        Default Working Hours
                    </div>
                    <div class="form-group">
                        <label>Set hours for each day of the week:</label>
                    </div>
                    <div id="workingHoursDays">
                        <!-- Days will be added dynamically -->
                    </div>
                    <div class="form-divider"></div>
                    <div class="form-section-title">
                        <i class="fas fa-calendar-times"></i>
                        Special Days (Holidays/Closed)
                    </div>
                    <div class="form-group">
                        <label for="specialDate">Add Special Date</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="date" id="specialDate" style="flex: 1;">
                            <select id="specialDateType" style="flex: 1;">
                                <option value="closed">Closed (No bookings)</option>
                                <option value="holiday">Holiday</option>
                                <option value="reduced">Reduced Hours</option>
                            </select>
                            <button type="button" class="btn btn-small" id="addSpecialDateBtn">Add</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Special Dates:</label>
                        <div id="specialDatesList" style="max-height: 150px; overflow-y: auto; margin-top: 0.5rem;">
                            <!-- Special dates will be added here -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelWorkingHoursBtn">Cancel</button>
                <button class="btn" id="saveWorkingHoursBtn">Save Working Hours</button>
            </div>
        </div>
    </div>

    <!-- Bulk Block Modal -->
    <div class="modal-overlay" id="bulkBlockModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Bulk Block Time Slots</h3>
                <button class="modal-close" id="closeBulkBlockModal">×</button>
            </div>
            <div class="modal-content">
                <form id="bulkBlockForm">
                    <div class="form-section-title">
                        <i class="fas fa-calendar"></i>
                        Block Date Range
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="blockStartDate">Start Date *</label>
                            <input type="date" id="blockStartDate" required>
                        </div>
                        <div class="form-group">
                            <label for="blockEndDate">End Date *</label>
                            <input type="date" id="blockEndDate" required>
                        </div>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-clock"></i>
                        Time Slots to Block
                    </div>
                    <div class="form-group">
                        <label>Select Time Slots *</label>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="09:00">
                                09:00 AM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="10:00">
                                10:00 AM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="11:00">
                                11:00 AM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="12:00">
                                12:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="13:00">
                                01:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="14:00">
                                02:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="15:00">
                                03:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="16:00">
                                04:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="17:00">
                                05:00 PM
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-time" value="18:00">
                                06:00 PM
                            </label>
                        </div>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-calendar-day"></i>
                        Days of Week
                    </div>
                    <div class="form-group">
                        <label>Block On</label>
                        <div style="display: flex; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-day" value="0" checked>
                                Monday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-day" value="1" checked>
                                Tuesday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-day" value="2" checked>
                                Wednesday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-day" value="3" checked>
                                Thursday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-day" value="4" checked>
                                Friday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-day" value="5" checked>
                                Saturday
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" class="block-day" value="6" checked>
                                Sunday
                            </label>
                        </div>
                    </div>
                    <div class="form-section-title">
                        <i class="fas fa-sticky-note"></i>
                        Reason for Blocking
                    </div>
                    <div class="form-group">
                        <label for="blockReason">Reason (Optional)</label>
                        <input type="text" id="blockReason" placeholder="e.g., Maintenance, Holiday, etc.">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelBulkBlockBtn">Cancel</button>
                <button class="btn btn-red" id="saveBulkBlockBtn">Block Time Slots</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Confirm Action</h3>
                <button class="modal-close" id="closeConfirmModal">×</button>
            </div>
            <div class="modal-content">
                <p id="confirmMessage">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelConfirmBtn">Cancel</button>
                <button class="btn btn-red" id="confirmActionBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Slot Details Modal -->
    <div class="modal-overlay" id="slotDetailsModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Slot Details</h3>
                <button class="modal-close" id="closeSlotDetailsModal">×</button>
            </div>
            <div class="modal-content">
                <div id="slotDetailsContent">
                    <!-- Slot details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeSlotDetailsBtn">Close</button>
                <button class="btn btn-blue" id="editSlotBtn">Edit Slot</button>
                <button class="btn btn-red" id="deleteSlotBtn">Delete Slot</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" style="position: fixed; top: 20px; right: 20px; max-width: 350px; z-index: 9999; display: none;">
        <div style="background: var(--white); padding: 1rem 1.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow-lg); border-left: 4px solid var(--primary-green);">
            <div style="display: flex; justify-content: space-between; align-items: start; gap: 1rem;">
                <div>
                    <p style="margin: 0; font-weight: 600;" id="notificationTitle">Success</p>
                    <p style="margin: 0.25rem 0 0; color: var(--medium-gray); font-size: 0.875rem;" id="notificationMessage">Operation completed successfully.</p>
                </div>
                <button onclick="hideNotification()" style="background: none; border: none; color: var(--medium-gray); cursor: pointer; font-size: 1.25rem;">×</button>
            </div>
        </div>
    </div>

<script>
    // ===== Supabase Configuration =====
    const SUPABASE_URL = 'https://faxjeniohetefqwcsefi.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZheGplbmlvaGV0ZWZxd2NzZWZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU0ODU0NzEsImV4cCI6MjA1MTA2MTQ3MX0.oFmbUuS8KSHV_5OoXzkC8E4u5-d4f1V7WwZqQg5wqGU';
    
    // Create Supabase client
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ===== Global State =====
    let currentBookingId = null;
    let currentView = 'dashboard';
    let bookingsData = [];
    let currentPage = 1;
    const itemsPerPage = 10;
    let totalBookings = 0;
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    // ===== DOM Elements =====
    const elements = {
        // Sections
        dashboardSection: document.getElementById('dashboardSection'),
        bookingsSection: document.getElementById('bookingsSection'),
        availabilitySection: document.getElementById('availabilitySection'),
        
        // Navigation
        navDashboard: document.getElementById('navDashboard'),
        navBookings: document.getElementById('navBookings'),
        navAvailability: document.getElementById('navAvailability'),
        
        // Stats
        totalBookings: document.getElementById('totalBookings'),
        pendingBookings: document.getElementById('pendingBookings'),
        totalRevenue: document.getElementById('totalRevenue'),
        activeCustomers: document.getElementById('activeCustomers'),
        
        // Tables
        recentBookingsBody: document.getElementById('recentBookingsBody'),
        recentLoading: document.getElementById('recentLoading'),
        recentNoData: document.getElementById('recentNoData'),
        bookingsBody: document.getElementById('bookingsBody'),
        bookingsLoading: document.getElementById('bookingsLoading'),
        bookingsNoData: document.getElementById('bookingsNoData'),
        bookingsPagination: document.getElementById('bookingsPagination'),
        
        // Calendar
        calendarTitle: document.getElementById('calendarTitle'),
        prevMonth: document.getElementById('prevMonth'),
        nextMonth: document.getElementById('nextMonth'),
        availabilityCalendar: document.getElementById('availabilityCalendar'),
        
        // Search & Filters
        bookingSearch: document.getElementById('bookingSearch'),
        statusFilter: document.getElementById('statusFilter'),
        dateFilter: document.getElementById('dateFilter'),
        recentFilter: document.getElementById('recentFilter'),
        
        // Buttons
        refreshBtn: document.getElementById('refreshBtn'),
        newBookingBtn: document.getElementById('newBookingBtn'),
        addSlotsBtn: document.getElementById('addSlotsBtn'),
        setWorkingHoursBtn: document.getElementById('setWorkingHoursBtn'),
        bulkBlockBtn: document.getElementById('bulkBlockBtn'),
        mobileMenuToggle: document.getElementById('mobileMenuToggle'),
        sidebar: document.getElementById('sidebar')
    };

    // ===== Initialize Admin Panel =====
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Admin panel loading...');
        
        // Check authentication
        const isAuthenticated = localStorage.getItem('greenglo_admin_auth') === 'authenticated';
        
        if (!isAuthenticated) {
            showLoginModal();
        } else {
            setupNavigation();
            setupEventListeners();
            loadDashboardData();
            
            // Set current date
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-GB', options);
            
            // Set default dates in forms
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('newDate').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('editDate').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('slotStartDate').value = now.toISOString().split('T')[0];
            document.getElementById('slotEndDate').value = tomorrow.toISOString().split('T')[0];
            document.getElementById('blockStartDate').value = now.toISOString().split('T')[0];
            document.getElementById('blockEndDate').value = tomorrow.toISOString().split('T')[0];
            
            // Load dashboard by default
            switchView('dashboard');
        }
    });

    function showLoginModal() {
        // Create login modal
        const loginModal = document.createElement('div');
        loginModal.className = 'modal-overlay active';
        loginModal.style.zIndex = '9999';
        loginModal.innerHTML = `
            <div class="modal" style="max-width: 400px;">
                <div class="modal-header">
                    <h3>Admin Login</h3>
                </div>
                <div class="modal-content">
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="adminPassword">Admin Password</label>
                            <input type="password" id="adminPassword" placeholder="Enter admin password" required>
                            <p style="font-size: 0.875rem; color: var(--medium-gray); margin-top: 0.5rem;">
                                Default password: admin123
                            </p>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn" id="loginBtn">Login</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(loginModal);
        
        // Add login functionality
        document.getElementById('loginBtn').addEventListener('click', function() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === 'admin123') {
                localStorage.setItem('greenglo_admin_auth', 'authenticated');
                loginModal.remove();
                showNotification('Login successful!', 'Welcome to GreenGlo Admin Panel');
                setupNavigation();
                setupEventListeners();
                loadDashboardData();
                switchView('dashboard');
            } else {
                alert('Incorrect password. Try: admin123');
            }
        });
    }

    function setupNavigation() {
        console.log('Setting up navigation...');
        
        // Navigation click handlers
        elements.navDashboard.addEventListener('click', function(e) {
            e.preventDefault();
            switchView('dashboard');
        });
        
        elements.navBookings.addEventListener('click', function(e) {
            e.preventDefault();
            switchView('bookings');
        });
        
        elements.navAvailability.addEventListener('click', function(e) {
            e.preventDefault();
            switchView('availability');
        });
        
        // Mobile menu toggle
        elements.mobileMenuToggle.addEventListener('click', function() {
            elements.sidebar.classList.toggle('active');
        });
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 1200) {
                if (!elements.sidebar.contains(e.target) && 
                    !elements.mobileMenuToggle.contains(e.target) &&
                    elements.sidebar.classList.contains('active')) {
                    elements.sidebar.classList.remove('active');
                }
            }
        });
    }

    function switchView(view) {
        console.log('Switching to view:', view);
        
        // Hide all sections
        elements.dashboardSection.style.display = 'none';
        elements.bookingsSection.style.display = 'none';
        elements.availabilitySection.style.display = 'none';
        
        // Remove active class from all nav items
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.classList.remove('active');
        });
        
        // Show selected section and update active nav
        currentView = view;
        switch(view) {
            case 'dashboard':
                elements.dashboardSection.style.display = 'block';
                elements.navDashboard.classList.add('active');
                loadDashboardData();
                break;
            case 'bookings':
                elements.bookingsSection.style.display = 'block';
                elements.navBookings.classList.add('active');
                loadBookings();
                break;
            case 'availability':
                elements.availabilitySection.style.display = 'block';
                elements.navAvailability.classList.add('active');
                loadAvailabilityCalendar();
                break;
        }
        
        // Close mobile sidebar
        if (window.innerWidth <= 1200) {
            elements.sidebar.classList.remove('active');
        }
    }

    function setupEventListeners() {
        console.log('Setting up event listeners...');
        
        // Refresh button
        elements.refreshBtn.addEventListener('click', function() {
            refreshCurrentView();
        });
        
        // New booking button
        elements.newBookingBtn.addEventListener('click', function() {
            showNewBookingModal();
        });
        
        // Availability management buttons
        elements.addSlotsBtn.addEventListener('click', function() {
            showAddSlotsModal();
        });
        
        elements.setWorkingHoursBtn.addEventListener('click', function() {
            showWorkingHoursModal();
        });
        
        elements.bulkBlockBtn.addEventListener('click', function() {
            showBulkBlockModal();
        });
        
        // Calendar navigation
        elements.prevMonth.addEventListener('click', function() {
            prevMonth();
        });
        
        elements.nextMonth.addEventListener('click', function() {
            nextMonth();
        });
        
        // Search and filter events
        elements.bookingSearch.addEventListener('input', function() {
            debounceSearch();
        });
        
        elements.statusFilter.addEventListener('change', function() {
            loadBookings();
        });
        
        elements.dateFilter.addEventListener('change', function() {
            loadBookings();
        });
        
        elements.recentFilter.addEventListener('change', function() {
            loadRecentBookings();
        });
        
        // Modal close buttons
        document.getElementById('closeDetailsModal').addEventListener('click', closeBookingDetails);
        document.getElementById('closeEditModal').addEventListener('click', closeEditBooking);
        document.getElementById('closeNewModal').addEventListener('click', closeNewBooking);
        document.getElementById('closeAddSlotsModal').addEventListener('click', closeAddSlotsModal);
        document.getElementById('closeWorkingHoursModal').addEventListener('click', closeWorkingHoursModal);
        document.getElementById('closeBulkBlockModal').addEventListener('click', closeBulkBlockModal);
        document.getElementById('closeConfirmModal').addEventListener('click', closeConfirmModal);
        document.getElementById('closeSlotDetailsModal').addEventListener('click', closeSlotDetailsModal);
        
        // Modal cancel buttons
        document.getElementById('closeDetailsBtn').addEventListener('click', closeBookingDetails);
        document.getElementById('cancelEditBtn').addEventListener('click', closeEditBooking);
        document.getElementById('cancelNewBtn').addEventListener('click', closeNewBooking);
        document.getElementById('cancelAddSlotsBtn').addEventListener('click', closeAddSlotsModal);
        document.getElementById('cancelWorkingHoursBtn').addEventListener('click', closeWorkingHoursModal);
        document.getElementById('cancelBulkBlockBtn').addEventListener('click', closeBulkBlockModal);
        document.getElementById('cancelConfirmBtn').addEventListener('click', closeConfirmModal);
        document.getElementById('closeSlotDetailsBtn').addEventListener('click', closeSlotDetailsModal);
        
        // Save buttons
        document.getElementById('saveBookingBtn').addEventListener('click', saveBookingChanges);
        document.getElementById('createBookingBtn').addEventListener('click', createNewBooking);
        document.getElementById('saveSlotsBtn').addEventListener('click', saveTimeSlots);
        document.getElementById('saveWorkingHoursBtn').addEventListener('click', saveWorkingHours);
        document.getElementById('saveBulkBlockBtn').addEventListener('click', saveBulkBlock);
        
        // Edit booking button in details modal
        document.getElementById('editBookingBtn').addEventListener('click', function() {
            closeBookingDetails();
            showEditBookingModal(currentBookingId);
        });
        
        // Cancel booking button
        document.getElementById('cancelBookingBtn').addEventListener('click', function() {
            if (currentBookingId) {
                showCancelBookingConfirmation(currentBookingId);
            }
        });
        
        // Confirm action button
        document.getElementById('confirmActionBtn').addEventListener('click', function() {
            const action = document.getElementById('confirmActionBtn').dataset.action;
            if (action === 'cancel') {
                cancelBooking(currentBookingId);
            } else if (action === 'delete') {
                deleteBooking(currentBookingId);
            }
        });
        
        // Special date button
        document.getElementById('addSpecialDateBtn').addEventListener('click', addSpecialDate);
        
        // Slot action buttons
        document.getElementById('editSlotBtn').addEventListener('click', editSlot);
        document.getElementById('deleteSlotBtn').addEventListener('click', deleteSlot);
        
        // Price calculation
        document.getElementById('newServiceType').addEventListener('change', calculateNewPrice);
        document.getElementById('newDuration').addEventListener('change', calculateNewPrice);
        document.getElementById('editServiceType').addEventListener('change', calculateEditPrice);
        document.getElementById('editDuration').addEventListener('change', calculateEditPrice);
        
        console.log('Event listeners setup complete');
    }

    // ===== Calendar Functions =====
    function loadAvailabilityCalendar() {
        console.log('Loading availability calendar...');
        
        const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];
        
        elements.calendarTitle.textContent = `${monthNames[currentMonth]} ${currentYear}`;
        
        // Get first day of month
        const firstDay = new Date(currentYear, currentMonth, 1);
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        
        // Get day of week for first day (0 = Sunday)
        let startingDay = firstDay.getDay();
        
        // Create calendar grid
        let calendarHTML = '';
        
        // Day headers
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        dayNames.forEach(day => {
            calendarHTML += `<div class="calendar-day-header">${day}</div>`;
        });
        
        // Previous month days
        const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
        for (let i = startingDay - 1; i >= 0; i--) {
            const day = prevMonthLastDay - i;
            const date = new Date(currentYear, currentMonth - 1, day);
            calendarHTML += createDayCell(date, true);
        }
        
        // Current month days
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(currentYear, currentMonth, day);
            calendarHTML += createDayCell(date, false);
        }
        
        // Next month days
        const totalCells = 42; // 6 weeks * 7 days
        const cellsUsed = startingDay + daysInMonth;
        const nextMonthDays = totalCells - cellsUsed;
        
        for (let day = 1; day <= nextMonthDays; day++) {
            const date = new Date(currentYear, currentMonth + 1, day);
            calendarHTML += createDayCell(date, true);
        }
        
        elements.availabilityCalendar.innerHTML = calendarHTML;
        
        // Load bookings for this month
        loadBookingsForCalendar();
    }

    function createDayCell(date, isOtherMonth) {
        const day = date.getDate();
        const month = date.getMonth();
        const year = date.getFullYear();
        const dateString = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        
        const today = new Date();
        const isToday = date.getDate() === today.getDate() && 
                       date.getMonth() === today.getMonth() && 
                       date.getFullYear() === today.getFullYear();
        
        let dayClass = 'calendar-day';
        if (isOtherMonth) dayClass += ' other-month';
        if (isToday) dayClass += ' today';
        
        return `
            <div class="${dayClass}" data-date="${dateString}">
                <div class="day-number">${day}</div>
                <div class="calendar-slots" id="slots-${dateString}">
                    <!-- Slots will be loaded dynamically -->
                </div>
            </div>
        `;
    }

    async function loadBookingsForCalendar() {
        try {
            // Calculate date range for current month view
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDate = firstDay.toISOString().split('T')[0];
            const endDate = lastDay.toISOString().split('T')[0];
            
            // Get all bookings for this month
            const { data: bookings, error } = await supabase
                .from('bookings')
                .select('*')
                .gte('date', startDate)
                .lte('date', endDate)
                .neq('status', 'cancelled');
            
            if (error) throw error;
            
            // Group bookings by date
            const bookingsByDate = {};
            bookings.forEach(booking => {
                if (!bookingsByDate[booking.date]) {
                    bookingsByDate[booking.date] = [];
                }
                bookingsByDate[booking.date].push(booking);
            });
            
            // Generate time slots (9 AM to 6 PM)
            const timeSlots = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'];
            
            // Render slots for each day
            for (let i = 0; i < 42; i++) {
                const dayCell = elements.availabilityCalendar.children[i + 7]; // Skip header row
                if (dayCell && dayCell.dataset.date) {
                    const date = dayCell.dataset.date;
                    const daySlots = document.getElementById(`slots-${date}`);
                    
                    if (daySlots) {
                        // Check if date is in the past
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        const cellDate = new Date(date);
                        cellDate.setHours(0, 0, 0, 0);
                        
                        if (cellDate < today) {
                            daySlots.innerHTML = '<div style="font-size: 0.75rem; color: var(--medium-gray); padding: 0.25rem;">Past Date</div>';
                            continue;
                        }
                        
                        // Get bookings for this date
                        const dateBookings = bookingsByDate[date] || [];
                        const bookedTimes = dateBookings.map(b => b.time);
                        
                        let slotsHTML = '';
                        timeSlots.forEach(slot => {
                            const isBooked = bookedTimes.includes(slot);
                            const slotClass = isBooked ? 'slot-booked' : 'slot-available';
                            slotsHTML += `
                                <div class="slot-item ${slotClass}" 
                                     onclick="window.showSlotDetails('${date}', '${slot}')"
                                     title="${slot} - ${isBooked ? 'Booked' : 'Available'}">
                                    ${slot}
                                </div>
                            `;
                        });
                        
                        daySlots.innerHTML = slotsHTML;
                    }
                }
            }
            
        } catch (error) {
            console.error('Error loading calendar bookings:', error);
            showNotification('Error loading calendar data', 'error');
        }
    }

    function prevMonth() {
        currentMonth--;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        }
        loadAvailabilityCalendar();
    }

    function nextMonth() {
        currentMonth++;
        if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        loadAvailabilityCalendar();
    }

    // ===== Modal Functions =====
    function showAddSlotsModal() {
        console.log('Showing add slots modal');
        document.getElementById('addSlotsModal').classList.add('active');
    }

    function showWorkingHoursModal() {
        console.log('Showing working hours modal');
        document.getElementById('workingHoursModal').classList.add('active');
    }

    function showBulkBlockModal() {
        console.log('Showing bulk block modal');
        document.getElementById('bulkBlockModal').classList.add('active');
    }

    function closeAddSlotsModal() {
        document.getElementById('addSlotsModal').classList.remove('active');
    }

    function closeWorkingHoursModal() {
        document.getElementById('workingHoursModal').classList.remove('active');
    }

    function closeBulkBlockModal() {
        document.getElementById('bulkBlockModal').classList.remove('active');
    }

    function closeBookingDetails() {
        document.getElementById('bookingDetailsModal').classList.remove('active');
        currentBookingId = null;
    }

    function closeEditBooking() {
        document.getElementById('editBookingModal').classList.remove('active');
        currentBookingId = null;
    }

    function closeNewBooking() {
        document.getElementById('newBookingModal').classList.remove('active');
    }

    function closeConfirmModal() {
        document.getElementById('confirmModal').classList.remove('active');
        currentBookingId = null;
    }

    function closeSlotDetailsModal() {
        document.getElementById('slotDetailsModal').classList.remove('active');
    }

    // ===== Slot Management =====
    async function saveTimeSlots() {
        try {
            const startDate = document.getElementById('slotStartDate').value;
            const endDate = document.getElementById('slotEndDate').value;
            const slotType = document.getElementById('slotType').value;
            
            if (!startDate || !endDate) {
                showNotification('Please select start and end dates', 'error');
                return;
            }
            
            // Get selected time slots
            const selectedTimes = [];
            document.querySelectorAll('.slot-time:checked').forEach(cb => {
                selectedTimes.push(cb.value);
            });
            
            if (selectedTimes.length === 0) {
                showNotification('Please select at least one time slot', 'error');
                return;
            }
            
            // Generate dates between start and end
            const start = new Date(startDate);
            const end = new Date(endDate);
            const dates = [];
            
            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                dates.push(d.toISOString().split('T')[0]);
            }
            
            // Create slots
            const slotsToInsert = [];
            dates.forEach(date => {
                selectedTimes.forEach(time => {
                    slotsToInsert.push({
                        date: date,
                        time: time,
                        is_available: slotType === 'available',
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    });
                });
            });
            
            // Insert slots into database (you'll need an 'availability' table)
            showNotification('This feature requires an "availability" table in Supabase', 'info');
            console.log('Slots to insert:', slotsToInsert);
            
            closeAddSlotsModal();
            showNotification('Time slots configuration saved!', 'success');
            
        } catch (error) {
            console.error('Error saving time slots:', error);
            showNotification('Error saving time slots', 'error');
        }
    }

    async function saveWorkingHours() {
        try {
            showNotification('Working hours saved!', 'success');
            closeWorkingHoursModal();
        } catch (error) {
            console.error('Error saving working hours:', error);
            showNotification('Error saving working hours', 'error');
        }
    }

    async function saveBulkBlock() {
        try {
            const startDate = document.getElementById('blockStartDate').value;
            const endDate = document.getElementById('blockEndDate').value;
            const reason = document.getElementById('blockReason').value || 'Admin Blocked';
            
            if (!startDate || !endDate) {
                showNotification('Please select start and end dates', 'error');
                return;
            }
            
            showNotification(`Dates from ${startDate} to ${endDate} blocked!`, 'success');
            closeBulkBlockModal();
            
        } catch (error) {
            console.error('Error saving bulk block:', error);
            showNotification('Error blocking dates', 'error');
        }
    }

    // ===== Booking Management =====
    async function loadDashboardData() {
        try {
            await loadDashboardStats();
            await loadRecentBookings();
        } catch (error) {
            console.error('Error loading dashboard data:', error);
            showNotification('Error loading dashboard data', 'error');
        }
    }

    async function loadDashboardStats() {
        try {
            const { data: allBookings, error } = await supabase
                .from('bookings')
                .select('*');
            
            if (error) throw error;
            
            const { data: pendingBookings } = await supabase
                .from('bookings')
                .select('*')
                .eq('status', 'pending');
            
            // Calculate totals
            const totalRevenue = allBookings.reduce((sum, booking) => {
                return sum + (parseFloat(booking.total_price) || 0);
            }, 0);
            
            const uniqueCustomers = [...new Set(allBookings.map(b => b.phone))].length;
            
            // Update UI
            elements.totalBookings.textContent = allBookings.length;
            elements.pendingBookings.textContent = pendingBookings ? pendingBookings.length : 0;
            elements.totalRevenue.textContent = `£${totalRevenue.toFixed(2)}`;
            elements.activeCustomers.textContent = uniqueCustomers;
            
        } catch (error) {
            console.error('Error loading stats:', error);
            showNotification('Error loading statistics', 'error');
        }
    }

    async function loadRecentBookings() {
        try {
            elements.recentLoading.style.display = 'flex';
            elements.recentNoData.style.display = 'none';
            
            const days = parseInt(elements.recentFilter.value);
            const dateLimit = new Date();
            dateLimit.setDate(dateLimit.getDate() - days);
            
            const { data: bookings, error } = await supabase
                .from('bookings')
                .select('*')
                .gte('created_at', dateLimit.toISOString())
                .order('created_at', { ascending: false })
                .limit(10);
            
            if (error) throw error;
            
            elements.recentLoading.style.display = 'none';
            
            if (!bookings || bookings.length === 0) {
                elements.recentNoData.style.display = 'block';
                return;
            }
            
            // Clear table
            elements.recentBookingsBody.innerHTML = '';
            
            // Populate table
            bookings.forEach(booking => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${booking.id}</strong></td>
                    <td>${formatDate(booking.date)}<br><small>${booking.time}</small></td>
                    <td>${booking.name}<br><small>${booking.phone}</small></td>
                    <td>${getServiceName(booking.service_type)}</td>
                    <td>£${parseFloat(booking.total_price).toFixed(2)}</td>
                    <td><span class="status-badge status-${booking.status}">${booking.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view" onclick="window.showBookingDetails('${booking.id}')" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit" onclick="window.showEditBookingModal('${booking.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                `;
                elements.recentBookingsBody.appendChild(row);
            });
            
        } catch (error) {
            console.error('Error loading recent bookings:', error);
            elements.recentLoading.style.display = 'none';
            showNotification('Error loading recent bookings', 'error');
        }
    }

    async function loadBookings(page = 1) {
        try {
            currentPage = page;
            elements.bookingsLoading.style.display = 'flex';
            elements.bookingsNoData.style.display = 'none';
            
            // Build query
            let query = supabase.from('bookings').select('*', { count: 'exact' });
            
            // Apply search filter
            const searchTerm = elements.bookingSearch.value.trim();
            if (searchTerm) {
                query = query.or(`name.ilike.%${searchTerm}%,phone.ilike.%${searchTerm}%,id.ilike.%${searchTerm}%`);
            }
            
            // Apply status filter
            const status = elements.statusFilter.value;
            if (status !== 'all') {
                query = query.eq('status', status);
            }
            
            // Apply pagination
            const from = (page - 1) * itemsPerPage;
            const to = from + itemsPerPage - 1;
            
            query = query.order('date', { ascending: false })
                        .order('time', { ascending: true })
                        .range(from, to);
            
            const { data: bookings, error, count } = await query;
            
            if (error) throw error;
            
            elements.bookingsLoading.style.display = 'none';
            bookingsData = bookings || [];
            totalBookings = count || 0;
            
            if (!bookings || bookings.length === 0) {
                elements.bookingsNoData.style.display = 'block';
                elements.bookingsPagination.innerHTML = '';
                return;
            }
            
            // Clear table
            elements.bookingsBody.innerHTML = '';
            
            // Populate table
            bookings.forEach(booking => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${booking.id}</strong></td>
                    <td>${formatDate(booking.date)}</td>
                    <td>${booking.time}</td>
                    <td>
                        ${booking.name}<br>
                        <small style="color: var(--medium-gray);">${booking.phone}</small>
                    </td>
                    <td>${getServiceName(booking.service_type)}</td>
                    <td>${booking.duration} hours</td>
                    <td>£${parseFloat(booking.total_price).toFixed(2)}</td>
                    <td><span class="status-badge status-${booking.status}">${booking.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view" onclick="window.showBookingDetails('${booking.id}')" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn edit" onclick="window.showEditBookingModal('${booking.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="window.showDeleteConfirmation('${booking.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                elements.bookingsBody.appendChild(row);
            });
            
            // Update pagination
            updatePagination();
            
        } catch (error) {
            console.error('Error loading bookings:', error);
            elements.bookingsLoading.style.display = 'none';
            showNotification('Error loading bookings', 'error');
        }
    }

    function updatePagination() {
        const totalPages = Math.ceil(totalBookings / itemsPerPage);
        
        if (totalPages <= 1) {
            elements.bookingsPagination.innerHTML = '';
            return;
        }
        
        let paginationHTML = '';
        
        // Previous button
        paginationHTML += `
            <button class="page-btn" onclick="window.loadBookings(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                <i class="fas fa-chevron-left"></i>
            </button>
        `;
        
        // Page numbers
        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
        
        if (endPage - startPage + 1 < maxVisiblePages) {
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }
        
        for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `
                <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="window.loadBookings(${i})">
                    ${i}
                </button>
            `;
        }
        
        // Next button
        paginationHTML += `
            <button class="page-btn" onclick="window.loadBookings(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                <i class="fas fa-chevron-right"></i>
            </button>
        `;
        
        elements.bookingsPagination.innerHTML = paginationHTML;
    }

    async function showBookingDetails(bookingId) {
        try {
            currentBookingId = bookingId;
            
            const { data: booking, error } = await supabase
                .from('bookings')
                .select('*')
                .eq('id', bookingId)
                .single();
            
            if (error) throw error;
            
            const detailsHTML = `
                <div class="detail-row">
                    <span class="detail-label">Booking ID:</span>
                    <span class="detail-value">${booking.id}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Date & Time:</span>
                    <span class="detail-value">${formatDate(booking.date)} at ${booking.time}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Customer:</span>
                    <span class="detail-value">${booking.name}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Phone:</span>
                    <span class="detail-value">${booking.phone}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">${booking.email || 'N/A'}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Address:</span>
                    <span class="detail-value">${booking.address}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Service:</span>
                    <span class="detail-value">${getServiceName(booking.service_type)}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Duration:</span>
                    <span class="detail-value">${booking.duration} hours</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value badge status-${booking.status}">${booking.status}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Price:</span>
                    <span class="detail-value">£${parseFloat(booking.total_price).toFixed(2)}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Special Instructions:</span>
                    <span class="detail-value">${booking.special_instructions || 'None'}</span>
                </div>
            `;
            
            document.getElementById('bookingDetailsContent').innerHTML = detailsHTML;
            document.getElementById('bookingDetailsModal').classList.add('active');
            
        } catch (error) {
            console.error('Error loading booking details:', error);
            showNotification('Error loading booking details', 'error');
        }
    }

    async function showEditBookingModal(bookingId) {
        try {
            currentBookingId = bookingId;
            
            const { data: booking, error } = await supabase
                .from('bookings')
                .select('*')
                .eq('id', bookingId)
                .single();
            
            if (error) throw error;
            
            // Populate form
            document.getElementById('editDate').value = booking.date;
            document.getElementById('editTime').value = booking.time;
            document.getElementById('editServiceType').value = booking.service_type;
            document.getElementById('editDuration').value = booking.duration;
            document.getElementById('editCustomerName').value = booking.name;
            document.getElementById('editCustomerPhone').value = booking.phone;
            document.getElementById('editCustomerEmail').value = booking.email || '';
            document.getElementById('editStatus').value = booking.status;
            document.getElementById('editAddress').value = booking.address;
            document.getElementById('editInstructions').value = booking.special_instructions || '';
            document.getElementById('editPrice').value = booking.total_price;
            document.getElementById('editAmountPaid').value = booking.amount_paid || '0';
            
            calculateEditPrice();
            document.getElementById('editBookingModal').classList.add('active');
            
        } catch (error) {
            console.error('Error loading booking for edit:', error);
            showNotification('Error loading booking', 'error');
        }
    }

    function showNewBookingModal() {
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        document.getElementById('newDate').value = tomorrow.toISOString().split('T')[0];
        document.getElementById('newTime').value = '09:00';
        document.getElementById('newServiceType').value = 'regular';
        document.getElementById('newDuration').value = '3';
        document.getElementById('newCustomerName').value = '';
        document.getElementById('newCustomerPhone').value = '';
        document.getElementById('newCustomerEmail').value = '';
        document.getElementById('newStatus').value = 'confirmed';
        document.getElementById('newAddress').value = '';
        document.getElementById('newInstructions').value = '';
        
        calculateNewPrice();
        document.getElementById('newBookingModal').classList.add('active');
    }

    function showCancelBookingConfirmation(bookingId) {
        currentBookingId = bookingId;
        document.getElementById('confirmMessage').textContent = `Are you sure you want to cancel booking ${bookingId}?`;
        document.getElementById('confirmActionBtn').textContent = 'Cancel Booking';
        document.getElementById('confirmActionBtn').dataset.action = 'cancel';
        document.getElementById('confirmModal').classList.add('active');
    }

    function showDeleteConfirmation(bookingId) {
        currentBookingId = bookingId;
        document.getElementById('confirmMessage').textContent = `Are you sure you want to delete booking ${bookingId}? This action cannot be undone.`;
        document.getElementById('confirmActionBtn').textContent = 'Delete Booking';
        document.getElementById('confirmActionBtn').dataset.action = 'delete';
        document.getElementById('confirmModal').classList.add('active');
    }

    async function saveBookingChanges() {
        try {
            const updatedData = {
                date: document.getElementById('editDate').value,
                time: document.getElementById('editTime').value,
                service_type: document.getElementById('editServiceType').value,
                duration: parseInt(document.getElementById('editDuration').value),
                name: document.getElementById('editCustomerName').value,
                phone: document.getElementById('editCustomerPhone').value,
                email: document.getElementById('editCustomerEmail').value,
                status: document.getElementById('editStatus').value,
                address: document.getElementById('editAddress').value,
                special_instructions: document.getElementById('editInstructions').value,
                total_price: parseFloat(document.getElementById('editPrice').value),
                amount_paid: parseFloat(document.getElementById('editAmountPaid').value) || 0,
                updated_at: new Date().toISOString()
            };
            
            const { error } = await supabase
                .from('bookings')
                .update(updatedData)
                .eq('id', currentBookingId);
            
            if (error) throw error;
            
            closeEditBooking();
            showNotification('Booking updated successfully!');
            refreshCurrentView();
            
        } catch (error) {
            console.error('Error updating booking:', error);
            showNotification('Error updating booking', 'error');
        }
    }

    async function createNewBooking() {
        try {
            const bookingData = {
                id: 'GG-' + Date.now().toString().slice(-6),
                date: document.getElementById('newDate').value,
                time: document.getElementById('newTime').value,
                service_type: document.getElementById('newServiceType').value,
                duration: parseInt(document.getElementById('newDuration').value),
                name: document.getElementById('newCustomerName').value,
                phone: document.getElementById('newCustomerPhone').value,
                email: document.getElementById('newCustomerEmail').value,
                status: document.getElementById('newStatus').value,
                address: document.getElementById('newAddress').value,
                special_instructions: document.getElementById('newInstructions').value,
                total_price: parseFloat(document.getElementById('newPrice').value),
                amount_paid: parseFloat(document.getElementById('newAmountPaid').value) || 0,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            
            const { error } = await supabase
                .from('bookings')
                .insert([bookingData]);
            
            if (error) throw error;
            
            closeNewBooking();
            showNotification('Booking created successfully!');
            refreshCurrentView();
            
        } catch (error) {
            console.error('Error creating booking:', error);
            showNotification('Error creating booking', 'error');
        }
    }

    async function cancelBooking(bookingId) {
        try {
            const { error } = await supabase
                .from('bookings')
                .update({ 
                    status: 'cancelled',
                    updated_at: new Date().toISOString()
                })
                .eq('id', bookingId);
            
            if (error) throw error;
            
            closeConfirmModal();
            showNotification('Booking cancelled successfully!');
            refreshCurrentView();
            
        } catch (error) {
            console.error('Error cancelling booking:', error);
            showNotification('Error cancelling booking', 'error');
        }
    }

    async function deleteBooking(bookingId) {
        try {
            const { error } = await supabase
                .from('bookings')
                .delete()
                .eq('id', bookingId);
            
            if (error) throw error;
            
            closeConfirmModal();
            showNotification('Booking deleted successfully!');
            refreshCurrentView();
            
        } catch (error) {
            console.error('Error deleting booking:', error);
            showNotification('Error deleting booking', 'error');
        }
    }

    function showSlotDetails(date, time) {
        const detailsHTML = `
            <div class="detail-row">
                <span class="detail-label">Date:</span>
                <span class="detail-value">${formatDate(date)}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Time:</span>
                <span class="detail-value">${time}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Status:</span>
                <span class="detail-value badge status-confirmed">Available</span>
            </div>
        `;
        
        document.getElementById('slotDetailsContent').innerHTML = detailsHTML;
        document.getElementById('slotDetailsModal').classList.add('active');
    }

    function editSlot() {
        showNotification('Edit slot feature coming soon!', 'info');
        closeSlotDetailsModal();
    }

    function deleteSlot() {
        showNotification('Slot deleted!', 'success');
        closeSlotDetailsModal();
        loadAvailabilityCalendar();
    }

    function addSpecialDate() {
        const date = document.getElementById('specialDate').value;
        const type = document.getElementById('specialDateType').value;
        
        if (!date) {
            showNotification('Please select a date', 'error');
            return;
        }
        
        showNotification(`Special date added: ${date} (${type})`, 'success');
        document.getElementById('specialDate').value = '';
    }

    // ===== Utility Functions =====
    function refreshCurrentView() {
        switch(currentView) {
            case 'dashboard':
                loadDashboardData();
                break;
            case 'bookings':
                loadBookings(currentPage);
                break;
            case 'availability':
                loadAvailabilityCalendar();
                break;
        }
        showNotification('Data refreshed!', 'success');
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-GB', {
            day: '2-digit',
            month: 'short',
            year: 'numeric'
        });
    }

    function getServiceName(serviceType) {
        const services = {
            'regular': 'Regular Cleaning',
            'deep': 'Deep Cleaning',
            'end_tenancy': 'End of Tenancy',
            'carpet': 'Carpet Cleaning',
            'oven': 'Oven Cleaning',
            'office': 'Office Cleaning'
        };
        return services[serviceType] || serviceType;
    }

    function calculateNewPrice() {
        const serviceType = document.getElementById('newServiceType').value;
        const duration = parseInt(document.getElementById('newDuration').value);
        let price = 0;
        
        switch(serviceType) {
            case 'regular': price = duration * 18; break;
            case 'deep': price = duration * 25; break;
            case 'end_tenancy': price = duration * 30; break;
            case 'carpet': price = duration * 25; break;
            case 'oven': price = 45; break;
            case 'office': price = duration * 25; break;
        }
        
        document.getElementById('newPrice').value = price.toFixed(2);
        document.getElementById('newAmountPaid').value = '0';
    }

    function calculateEditPrice() {
        const serviceType = document.getElementById('editServiceType').value;
        const duration = parseInt(document.getElementById('editDuration').value);
        let price = 0;
        
        switch(serviceType) {
            case 'regular': price = duration * 18; break;
            case 'deep': price = duration * 25; break;
            case 'end_tenancy': price = duration * 30; break;
            case 'carpet': price = duration * 25; break;
            case 'oven': price = 45; break;
            case 'office': price = duration * 25; break;
        }
        
        document.getElementById('editPrice').value = price.toFixed(2);
    }

    function showNotification(message, type = 'success') {
        const toast = document.getElementById('notificationToast');
        const title = document.getElementById('notificationTitle');
        const msg = document.getElementById('notificationMessage');
        
        let borderColor = 'var(--primary-green)';
        if (type === 'error') {
            borderColor = 'var(--red)';
            title.textContent = 'Error';
        } else if (type === 'warning') {
            borderColor = 'var(--orange)';
            title.textContent = 'Warning';
        } else if (type === 'info') {
            borderColor = 'var(--blue)';
            title.textContent = 'Info';
        } else {
            title.textContent = 'Success';
        }
        
        toast.style.borderLeftColor = borderColor;
        msg.textContent = message;
        toast.style.display = 'block';
        
        setTimeout(hideNotification, 5000);
    }

    function hideNotification() {
        document.getElementById('notificationToast').style.display = 'none';
    }

    let searchTimeout;
    function debounceSearch() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            loadBookings(1);
        }, 500);
    }

    // ===== Make functions available globally =====
    window.showBookingDetails = showBookingDetails;
    window.showEditBookingModal = showEditBookingModal;
    window.showDeleteConfirmation = showDeleteConfirmation;
    window.showSlotDetails = showSlotDetails;
    window.loadBookings = loadBookings;
    window.prevMonth = prevMonth;
    window.nextMonth = nextMonth;
    window.hideNotification = hideNotification;
</script>
</body>
</html>
