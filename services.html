<!-- 预订模态框 -->
<div id="bookingModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center; padding: 20px;">
    <div style="background: white; border-radius: 16px; width: 100%; max-width: 800px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
        <!-- 模态框头部 -->
        <div style="padding: 1.5rem 2rem; border-bottom: 1px solid var(--light-gray); display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; color: var(--dark-green);" id="bookingServiceTitle">Book Service</h3>
            <button onclick="closeBookingModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--medium-gray); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;">
                &times;
            </button>
        </div>
        
        <!-- 预订步骤指示器 -->
        <div style="padding: 1.5rem 2rem; background: var(--off-white);">
            <div style="display: flex; align-items: center; justify-content: space-between; max-width: 400px; margin: 0 auto;">
                <div style="text-align: center; flex: 1;">
                    <div style="width: 32px; height: 32px; background: var(--primary-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.5rem; font-weight: bold;">1</div>
                    <div style="font-size: 0.875rem; color: var(--dark-green); font-weight: 500;">Select Date & Time</div>
                </div>
                <div style="height: 2px; background: var(--light-gray); flex: 1; margin: 0 1rem;"></div>
                <div style="text-align: center; flex: 1;">
                    <div style="width: 32px; height: 32px; background: var(--light-gray); color: var(--medium-gray); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.5rem; font-weight: bold;">2</div>
                    <div style="font-size: 0.875rem; color: var(--medium-gray);">Your Details</div>
                </div>
            </div>
        </div>
        
        <!-- 预订内容区域 -->
        <div style="padding: 2rem;">
            <div id="step1">
                <div style="margin-bottom: 2rem;">
                    <h4 style="color: var(--dark-gray); margin-bottom: 1rem;">Select Date</h4>
                    <div id="bookingCalendar" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; margin-bottom: 1.5rem;">
                        <!-- 日历将通过JavaScript生成 -->
                    </div>
                </div>
                
                <div id="timeSlotsSection" style="display: none;">
                    <h4 style="color: var(--dark-gray); margin-bottom: 1rem;">Available Time Slots for <span id="selectedDateText">Selected Date</span></h4>
                    <div id="availableTimeSlots" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.75rem; margin-bottom: 2rem;">
                        <!-- 可用时间段将通过JavaScript生成 -->
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between;">
                    <button onclick="closeBookingModal()" style="padding: 0.875rem 1.5rem; background: var(--light-gray); border: none; border-radius: 8px; font-weight: 600; cursor: pointer; color: var(--dark-gray);">
                        Cancel
                    </button>
                    <button onclick="goToStep2()" id="nextStepBtn" style="padding: 0.875rem 1.5rem; background: var(--light-gray); border: none; border-radius: 8px; font-weight: 600; cursor: not-allowed; color: var(--medium-gray);" disabled>
                        Next: Your Details
                    </button>
                </div>
            </div>
            
            <div id="step2" style="display: none;">
                <form id="bookingForm">
                    <input type="hidden" id="selectedServiceId">
                    <input type="hidden" id="selectedSlotId">
                    <input type="hidden" id="selectedSlotDate">
                    <input type="hidden" id="selectedSlotTime">
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-gray);">First Name *</label>
                            <input type="text" id="firstName" required style="width: 100%; padding: 0.875rem; border: 2px solid var(--light-gray); border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-gray);">Last Name *</label>
                            <input type="text" id="lastName" required style="width: 100%; padding: 0.875rem; border: 2px solid var(--light-gray); border-radius: 8px; font-size: 1rem;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-gray);">Email Address *</label>
                        <input type="email" id="email" required style="width: 100%; padding: 0.875rem; border: 2px solid var(--light-gray); border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-gray);">Phone Number *</label>
                        <input type="tel" id="phone" required style="width: 100%; padding: 0.875rem; border: 2px solid var(--light-gray); border-radius: 8px; font-size: 1rem;">
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-gray);">Address</label>
                        <textarea id="address" rows="3" style="width: 100%; padding: 0.875rem; border: 2px solid var(--light-gray); border-radius: 8px; font-size: 1rem; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 2rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--dark-gray);">Special Instructions</label>
                        <textarea id="instructions" rows="3" placeholder="Any specific requirements or notes for our team..." style="width: 100%; padding: 0.875rem; border: 2px solid var(--light-gray); border-radius: 8px; font-size: 1rem; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between;">
                        <button type="button" onclick="goToStep1()" style="padding: 0.875rem 1.5rem; background: var(--light-gray); border: none; border-radius: 8px; font-weight: 600; cursor: pointer; color: var(--dark-gray);">
                            ← Back
                        </button>
                        <button type="submit" style="padding: 0.875rem 1.5rem; background: var(--primary-green); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-calendar-check"></i>
                            Confirm Booking
                        </button>
                    </div>
                </form>
            </div>
            
            <div id="step3" style="display: none; text-align: center; padding: 3rem 1rem;">
                <div style="width: 80px; height: 80px; background: var(--light-green); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 2rem; color: var(--primary-green); font-size: 2rem;">
                    <i class="fas fa-check"></i>
                </div>
                <h3 style="color: var(--dark-green); margin-bottom: 1rem;">Booking Confirmed!</h3>
                <p style="color: var(--medium-gray); margin-bottom: 2rem; max-width: 500px; margin-left: auto; margin-right: auto;">
                    Thank you for booking with GreenGlo Cleaners. We have sent a confirmation to your email.
                    Our team will contact you shortly to confirm the details.
                </p>
                <div style="background: var(--off-white); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; text-align: left;">
                    <h4 style="color: var(--dark-green); margin-bottom: 0.5rem;">Booking Summary</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                        <div style="color: var(--medium-gray);">Service:</div>
                        <div style="font-weight: 600;" id="bookingSummaryService"></div>
                        
                        <div style="color: var(--medium-gray);">Date:</div>
                        <div style="font-weight: 600;" id="bookingSummaryDate"></div>
                        
                        <div style="color: var(--medium-gray);">Time:</div>
                        <div style="font-weight: 600;" id="bookingSummaryTime"></div>
                        
                        <div style="color: var(--medium-gray);">Reference:</div>
                        <div style="font-weight: 600;" id="bookingReference"></div>
                    </div>
                </div>
                <button onclick="closeBookingModal()" style="padding: 0.875rem 1.5rem; background: var(--primary-green); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                    Done
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    /* 预订模态框样式 */
    #bookingModal {
        font-family: 'Montserrat', sans-serif;
    }
    
    #bookingModal button:hover {
        opacity: 0.9;
        transform: translateY(-1px);
    }
    
    /* 时间槽位样式 */
    .time-slot-option {
        padding: 1rem;
        border: 2px solid var(--light-gray);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        background: white;
    }
    
    .time-slot-option:hover {
        border-color: var(--primary-green);
        background: var(--light-green);
    }
    
    .time-slot-option.selected {
        background: var(--primary-green);
        color: white;
        border-color: var(--primary-green);
    }
    
    .time-slot-option.unavailable {
        background: var(--off-white);
        color: var(--medium-gray);
        cursor: not-allowed;
        opacity: 0.7;
    }
    
    /* 日历样式 */
    .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid var(--light-gray);
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        background: white;
    }
    
    .calendar-day:hover {
        border-color: var(--primary-green);
    }
    
    .calendar-day.selected {
        background: var(--primary-green);
        color: white;
        border-color: var(--primary-green);
    }
    
    .calendar-day.unavailable {
        background: var(--off-white);
        color: var(--medium-gray);
        cursor: not-allowed;
        opacity: 0.5;
    }
    
    .calendar-day.today {
        border-color: var(--primary-green);
    }
    
    /* 加载动画 */
    .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        color: var(--medium-gray);
    }
    
    .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid var(--light-gray);
        border-top: 3px solid var(--primary-green);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 1rem;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
<script> // ===== Supabase配置 =====
const SUPABASE_URL = 'https://faxjeniohetefqwcsefi.supabase.co';
const SUPABASE_PUBLISHABLE_KEY = 'sb_publishable_7TZ_Y-HKZc_ibl59lqyAsQ_Qbv9A2o7';

// 初始化Supabase客户端
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY);

// ===== 预订系统全局变量 =====
let currentBookingService = null;
let selectedSlot = null;
let selectedDate = null;
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

// ===== 预订模态框函数 =====
function openBookingModal(serviceId) {
    currentBookingService = servicesData.find(s => s.id === serviceId);
    if (!currentBookingService) return;
    
    document.getElementById('bookingServiceTitle').textContent = `Book: ${currentBookingService.title}`;
    document.getElementById('selectedServiceId').value = serviceId;
    
    // 重置步骤
    document.getElementById('step1').style.display = 'block';
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step3').style.display = 'none';
    document.getElementById('timeSlotsSection').style.display = 'none';
    document.getElementById('nextStepBtn').disabled = true;
    document.getElementById('nextStepBtn').style.background = 'var(--light-gray)';
    document.getElementById('nextStepBtn').style.color = 'var(--medium-gray)';
    document.getElementById('nextStepBtn').style.cursor = 'not-allowed';
    
    // 生成日历
    renderBookingCalendar();
    
    // 显示模态框
    document.getElementById('bookingModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeBookingModal() {
    document.getElementById('bookingModal').style.display = 'none';
    document.body.style.overflow = '';
    currentBookingService = null;
    selectedSlot = null;
    selectedDate = null;
}

function goToStep2() {
    if (!selectedSlot) return;
    
    document.getElementById('step1').style.display = 'none';
    document.getElementById('step2').style.display = 'block';
    
    // 更新步骤指示器
    document.querySelectorAll('.step-indicator').forEach((el, index) => {
        if (index === 0) {
            el.style.background = 'var(--light-green)';
            el.querySelector('div').style.color = 'var(--primary-green)';
        } else if (index === 1) {
            el.style.background = 'var(--primary-green)';
            el.querySelector('div').style.color = 'white';
        }
    });
}

function goToStep1() {
    document.getElementById('step1').style.display = 'block';
    document.getElementById('step2').style.display = 'none';
    
    // 更新步骤指示器
    document.querySelectorAll('.step-indicator').forEach((el, index) => {
        if (index === 0) {
            el.style.background = 'var(--primary-green)';
            el.querySelector('div').style.color = 'white';
        } else if (index === 1) {
            el.style.background = 'var(--light-gray)';
            el.querySelector('div').style.color = 'var(--medium-gray)';
        }
    });
}

// ===== 日历渲染 =====
async function renderBookingCalendar() {
    const calendar = document.getElementById('bookingCalendar');
    calendar.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading availability...</p></div>';
    
    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDay = firstDay.getDay();
    
    // 获取这个月的可用日期
    const startDate = firstDay.toISOString().split('T')[0];
    const endDate = lastDay.toISOString().split('T')[0];
    
    try {
        const { data: availableDates, error } = await supabase
            .from('availability_slots')
            .select('slot_date')
            .eq('is_available', true)
            .gte('slot_date', startDate)
            .lte('slot_date', endDate)
            .lt('current_bookings', supabase.raw('max_capacity'));
        
        if (error) throw error;
        
        // 创建唯一日期列表
        const availableDatesSet = new Set(availableDates.map(d => d.slot_date));
        
        calendar.innerHTML = '';
        
        // 添加星期几的标题
        const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        weekdays.forEach(day => {
            const dayElement = document.createElement('div');
            dayElement.style.textAlign = 'center';
            dayElement.style.fontWeight = '600';
            dayElement.style.color = 'var(--dark-gray)';
            dayElement.style.padding = '0.5rem';
            dayElement.textContent = day;
            calendar.appendChild(dayElement);
        });
        
        // 添加空白天数
        for (let i = 0; i < startingDay; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day unavailable';
            calendar.appendChild(emptyDay);
        }
        
        // 添加月份天数
        const today = new Date();
        const todayString = today.toISOString().split('T')[0];
        
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(currentYear, currentMonth, day);
            const dateString = date.toISOString().split('T')[0];
            
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;
            dayElement.dataset.date = dateString;
            
            // 检查是否是今天
            if (dateString === todayString) {
                dayElement.classList.add('today');
            }
            
            // 检查日期是否可用
            if (!availableDatesSet.has(dateString) || date < today) {
                dayElement.classList.add('unavailable');
            } else {
                dayElement.addEventListener('click', () => {
                    selectBookingDate(date);
                });
            }
            
            calendar.appendChild(dayElement);
        }
        
    } catch (error) {
        console.error('Error loading calendar:', error);
        calendar.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--medium-gray);">Unable to load calendar. Please try again later.</div>';
    }
}

async function selectBookingDate(date) {
    selectedDate = date;
    const dateString = date.toISOString().split('T')[0];
    
    // 清除之前的选择
    document.querySelectorAll('.calendar-day').forEach(day => {
        day.classList.remove('selected');
    });
    
    // 标记选中的日期
    const selectedDay = document.querySelector(`.calendar-day[data-date="${dateString}"]`);
    if (selectedDay) {
        selectedDay.classList.add('selected');
    }
    
    // 更新日期显示
    const dateText = date.toLocaleDateString('en-GB', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    document.getElementById('selectedDateText').textContent = dateText;
    
    // 加载可用时间段
    await loadAvailableTimeSlots(dateString);
    
    // 显示时间段部分
    document.getElementById('timeSlotsSection').style.display = 'block';
}

async function loadAvailableTimeSlots(date) {
    const container = document.getElementById('availableTimeSlots');
    container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading time slots...</p></div>';
    
    try {
        const { data: slots, error } = await supabase
            .from('availability_slots')
            .select('*')
            .eq('slot_date', date)
            .eq('is_available', true)
            .lt('current_bookings', supabase.raw('max_capacity'))
            .order('start_time', { ascending: true });
        
        if (error) throw error;
        
        if (!slots || slots.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--medium-gray);">
                    <i class="fas fa-calendar-times" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <p>No time slots available for this date</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = '';
        
        slots.forEach(slot => {
            const slotElement = document.createElement('div');
            slotElement.className = 'time-slot-option';
            slotElement.dataset.slotId = slot.id;
            
            const startTime = slot.start_time.substring(0, 5);
            const endTime = slot.end_time.substring(0, 5);
            
            slotElement.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 0.25rem;">${startTime} - ${endTime}</div>
                <div style="font-size: 0.75rem; color: var(--primary-green);">
                    ${slot.current_bookings}/${slot.max_capacity} booked
                </div>
            `;
            
            slotElement.addEventListener('click', () => {
                selectTimeSlot(slot.id, `${startTime} - ${endTime}`, date);
            });
            
            container.appendChild(slotElement);
        });
        
    } catch (error) {
        console.error('Error loading time slots:', error);
        container.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--red);">
                <i class="fas fa-exclamation-circle"></i>
                <p>Unable to load time slots</p>
            </div>
        `;
    }
}

function selectTimeSlot(slotId, timeRange, date) {
    selectedSlot = slotId;
    
    // 清除之前的选择
    document.querySelectorAll('.time-slot-option').forEach(slot => {
        slot.classList.remove('selected');
    });
    
    // 标记选中的时间段
    const selectedSlotElement = document.querySelector(`.time-slot-option[data-slot-id="${slotId}"]`);
    if (selectedSlotElement) {
        selectedSlotElement.classList.add('selected');
    }
    
    // 启用下一步按钮
    const nextStepBtn = document.getElementById('nextStepBtn');
    nextStepBtn.disabled = false;
    nextStepBtn.style.background = 'var(--primary-green)';
    nextStepBtn.style.color = 'white';
    nextStepBtn.style.cursor = 'pointer';
    
    // 保存选中的信息
    document.getElementById('selectedSlotId').value = slotId;
    document.getElementById('selectedSlotDate').value = date;
    document.getElementById('selectedSlotTime').value = timeRange;
}

// ===== 预订表单提交 =====
document.getElementById('bookingForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        service_id: document.getElementById('selectedServiceId').value,
        slot_id: document.getElementById('selectedSlotId').value,
        customer_name: `${document.getElementById('firstName').value} ${document.getElementById('lastName').value}`,
        customer_email: document.getElementById('email').value,
        customer_phone: document.getElementById('phone').value,
        customer_address: document.getElementById('address').value,
        booking_date: document.getElementById('selectedSlotDate').value,
        start_time: document.getElementById('selectedSlotTime').value.split(' - ')[0] + ':00',
        end_time: document.getElementById('selectedSlotTime').value.split(' - ')[1] + ':00',
        special_instructions: document.getElementById('instructions').value,
        status: 'pending'
    };
    
    try {
        // 首先检查时间段是否仍然可用
        const { data: slot, error: slotError } = await supabase
            .from('availability_slots')
            .select('*')
            .eq('id', formData.slot_id)
            .single();
        
        if (slotError) throw slotError;
        
        if (slot.current_bookings >= slot.max_capacity) {
            alert('Sorry, this time slot has just been booked by someone else. Please select another time.');
            return;
        }
        
        // 创建预订
        const { data: booking, error: bookingError } = await supabase
            .from('customer_bookings')
            .insert([{
                service_id: formData.service_id,
                customer_name: formData.customer_name,
                customer_email: formData.customer_email,
                customer_phone: formData.customer_phone,
                customer_address: formData.customer_address,
                booking_date: formData.booking_date,
                start_time: formData.start_time,
                end_time: formData.end_time,
                special_instructions: formData.special_instructions,
                status: 'pending'
            }])
            .select();
        
        if (bookingError) throw bookingError;
        
        // 更新时间段的预订数量
        const { error: updateError } = await supabase
            .from('availability_slots')
            .update({
                current_bookings: slot.current_bookings + 1,
                is_available: (slot.current_bookings + 1) < slot.max_capacity
            })
            .eq('id', formData.slot_id);
        
        if (updateError) throw updateError;
        
        // 显示确认页面
        showBookingConfirmation(booking[0]);
        
    } catch (error) {
        console.error('Booking error:', error);
        alert('Sorry, there was an error processing your booking. Please try again or contact us directly.');
    }
});

function showBookingConfirmation(booking) {
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step3').style.display = 'block';
    
    // 更新确认信息
    document.getElementById('bookingSummaryService').textContent = currentBookingService.title;
    document.getElementById('bookingSummaryDate').textContent = 
        new Date(booking.booking_date).toLocaleDateString('en-GB');
    document.getElementById('bookingSummaryTime').textContent = 
        `${booking.start_time.substring(0, 5)} - ${booking.end_time.substring(0, 5)}`;
    document.getElementById('bookingReference').textContent = 
        booking.id.substring(0, 8).toUpperCase();
    
    // 发送确认邮件（可选）
    sendConfirmationEmail(booking);
}

async function sendConfirmationEmail(booking) {
    // 这里可以添加发送确认邮件的代码
    // 您可以使用Supabase Edge Functions或第三方服务
    console.log('Booking confirmed:', booking);
}

// ===== 修改服务卡片，添加预订按钮 =====
function renderServices(category = 'all') {
    const servicesGrid = document.getElementById('servicesGrid');
    servicesGrid.innerHTML = '';

    const filteredServices = category === 'all'
        ? servicesData
        : servicesData.filter(service => service.category === category);

    filteredServices.forEach(service => {
        const serviceCard = document.createElement('div');
        serviceCard.className = 'service-card';
        serviceCard.setAttribute('data-category', service.category);

        serviceCard.innerHTML = `
            <div class="service-image" style="background-image: url('${service.image}');">
                <div class="service-overlay">
                    <h3>${service.title}</h3>
                </div>
            </div>
            <div class="service-content">
                <p class="service-description">${service.description}</p>
                <ul class="service-features">
                    ${service.features.map(feature => `
                        <li><i class="fas fa-check"></i>${feature}</li>
                    `).join('')}
                </ul>
                <div class="service-meta">
                    <div class="service-duration">
                        <i class="far fa-clock"></i>
                        <span>${service.duration}</span>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn" onclick="openBookingModal(${service.id})" style="padding: 0.75rem 1.5rem;">
                            <i class="fas fa-calendar-alt"></i>
                            Book Now
                        </button>
                        <a class="btn btn-outline" href="https://api.whatsapp.com/send?phone=447827784204&text=Hello, I'm interested in your ${service.title} service. Can you provide more information?" style="padding: 0.75rem 1.5rem;">
                            <i class="fab fa-whatsapp"></i>
                            Inquire
                        </a>
                    </div>
                </div>
            </div>
        `;

        servicesGrid.appendChild(serviceCard);
    });

    // 添加加载动画
    const serviceCards = document.querySelectorAll('.service-card');
    serviceCards.forEach((el, index) => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
    });

    const elementObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, { threshold: 0.1 });

    serviceCards.forEach(el => elementObserver.observe(el));
}

// ===== 修改导航栏，添加管理面板链接 =====
// 在现有的导航菜单中添加管理面板链接
document.addEventListener('DOMContentLoaded', function() {
    // 找到导航菜单
    const navMenu = document.getElementById('navMenu');
    
    // 创建管理面板链接
    const adminNavItem = document.createElement('li');
    adminNavItem.className = 'nav-item';
    adminNavItem.innerHTML = `
        <a href="admin.html" class="nav-link" style="color: var(--primary-green); font-weight: bold;">
            <i class="fas fa-user-shield"></i>
            Admin Panel
        </a>
    `;
    
    // 将管理面板链接添加到导航菜单中（在联系链接之前）
    const contactItem = document.querySelector('.nav-item:last-child');
    navMenu.insertBefore(adminNavItem, contactItem);
    
    // 对于移动菜单也做同样的处理
    const mobileNavMenu = document.getElementById('navMenu');
    if (mobileNavMenu) {
        const mobileAdminItem = document.createElement('li');
        mobileAdminItem.className = 'nav-item';
        mobileAdminItem.innerHTML = `
            <a href="admin.html" class="nav-link" style="color: var(--primary-green); font-weight: bold;">
                <i class="fas fa-user-shield"></i>
                Admin Panel
            </a>
        `;
        
        const mobileContactItem = mobileNavMenu.querySelector('.nav-item:last-child');
        mobileNavMenu.insertBefore(mobileAdminItem, mobileContactItem);
    }
});

// ===== 初始化 =====
document.addEventListener('DOMContentLoaded', function() {
    // 检查用户是否在移动设备上
    if (window.innerWidth <= 768) {
        // 移动设备上的优化
        document.querySelectorAll('.btn').forEach(btn => {
            btn.style.padding = '0.75rem 1rem';
        });
    }
    
    // 添加键盘快捷键
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeBookingModal();
        }
    });
});</script>
