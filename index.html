<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Existing meta tags, title, and styles remain the same -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>GreenGlo Cleaners | Premium Eco-Friendly Cleaning Services London</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="logo.png">
    <!-- Apple Touch Icon for iOS devices -->
    <link rel="apple-touch-icon" href="logo.png">
    <!-- For IE and older browsers -->
    <link rel="shortcut icon" type="image/x-icon" href="logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <!-- Leaflet CSS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    
    <!-- GreenGlo Analytics Tracking Script -->
    <script>
        // =============================================
        // WEBSITE ANALYTICS TRACKING SYSTEM
        // =============================================

        // Configuration
        const ANALYTICS_CONFIG = {
            supabaseUrl: 'https://faxjeniohetefqwcsefi.supabase.co',
            supabaseKey: 'sb_publishable_7TZ_Y-HKZc_ibl59lqyAsQ_Qbv9A2o7',
            trackingEnabled: true,
            sessionTimeout: 30 * 60 * 1000, // 30 minutes
            pageviewTimeout: 10 * 1000, // 10 seconds for time on page
            debugMode: false
        };

        // Analytics state
        let analytics = {
            sessionId: null,
            currentPage: null,
            lastActivity: Date.now(),
            pageStartTime: Date.now(),
            scrollDepth: 0,
            sessionStartTime: Date.now(),
            supabaseClient: null,
            deviceInfo: {},
            utmParams: {}
        };

        // Initialize analytics
        function initAnalytics() {
            try {
                // Generate session ID
                analytics.sessionId = generateSessionId();
                
                // Get device and browser information
                analytics.deviceInfo = getDeviceInfo();
                
                // Parse UTM parameters
                analytics.utmParams = getUtmParams();
                
                // Initialize Supabase client
                if (typeof supabase !== 'undefined') {
                    analytics.supabaseClient = supabase.createClient(
                        ANALYTICS_CONFIG.supabaseUrl,
                        ANALYTICS_CONFIG.supabaseKey
                    );
                    console.log('[Analytics] Supabase client initialized');
                }
                
                // Start tracking
                startSessionTracking();
                setupEventListeners();
                trackPageView();
                
                // Set up session timeout
                setInterval(checkSessionTimeout, 60000); // Check every minute
                
                console.log('[Analytics] Tracking initialized successfully');
                
            } catch (error) {
                console.error('[Analytics] Initialization error:', error);
            }
        }

        // Generate unique session ID
        function generateSessionId() {
            const storedSessionId = localStorage.getItem('gg_session_id');
            const lastSessionTime = localStorage.getItem('gg_session_time');
            const now = Date.now();
            
            // If session exists and is less than 30 minutes old, keep it
            if (storedSessionId && lastSessionTime && (now - parseInt(lastSessionTime)) < ANALYTICS_CONFIG.sessionTimeout) {
                return storedSessionId;
            }
            
            // Generate new session ID
            const sessionId = 'gg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('gg_session_id', sessionId);
            localStorage.setItem('gg_session_time', now.toString());
            
            return sessionId;
        }

        // Get device and browser information
        function getDeviceInfo() {
            const ua = navigator.userAgent;
            let deviceType = 'desktop';
            let browser = 'unknown';
            let os = 'unknown';
            
            // Detect device type
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua)) {
                deviceType = 'mobile';
            } else if (/Tablet|iPad/i.test(ua)) {
                deviceType = 'tablet';
            }
            
            // Detect browser
            if (ua.includes('Chrome') && !ua.includes('Edg')) {
                browser = 'Chrome';
            } else if (ua.includes('Firefox')) {
                browser = 'Firefox';
            } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
                browser = 'Safari';
            } else if (ua.includes('Edg')) {
                browser = 'Edge';
            }
            
            // Detect OS
            if (ua.includes('Windows')) {
                os = 'Windows';
            } else if (ua.includes('Mac OS')) {
                os = 'macOS';
            } else if (ua.includes('Linux')) {
                os = 'Linux';
            } else if (ua.includes('Android')) {
                os = 'Android';
            } else if (ua.includes('iOS') || ua.includes('iPhone') || ua.includes('iPad')) {
                os = 'iOS';
            }
            
            return {
                deviceType,
                browser,
                os,
                screenResolution: `${screen.width}x${screen.height}`,
                language: navigator.language || navigator.userLanguage,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                userAgent: ua
            };
        }

        // Parse UTM parameters from URL
        function getUtmParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                source: params.get('utm_source') || document.referrer ? getReferrerSource(document.referrer) : 'direct',
                medium: params.get('utm_medium') || 'organic',
                campaign: params.get('utm_campaign') || '',
                term: params.get('utm_term') || '',
                content: params.get('utm_content') || ''
            };
        }

        // Determine referrer source
        function getReferrerSource(referrer) {
            if (!referrer) return 'direct';
            
            const referrerUrl = new URL(referrer);
            const hostname = referrerUrl.hostname;
            
            if (hostname.includes('google') || hostname.includes('bing') || hostname.includes('yahoo')) {
                return 'organic';
            } else if (hostname.includes('facebook') || hostname.includes('instagram') || hostname.includes('tiktok')) {
                return 'social';
            } else {
                return 'referral';
            }
        }

        // Start session tracking
        async function startSessionTracking() {
            try {
                const isFirstVisit = !localStorage.getItem('gg_first_visit');
                if (isFirstVisit) {
                    localStorage.setItem('gg_first_visit', 'true');
                }
                
                const sessionData = {
                    session_id: analytics.sessionId,
                    user_id: getUserId(),
                    device_type: analytics.deviceInfo.deviceType,
                    browser: analytics.deviceInfo.browser,
                    os: analytics.deviceInfo.os,
                    screen_resolution: analytics.deviceInfo.screenResolution,
                    language: analytics.deviceInfo.language,
                    timezone: analytics.deviceInfo.timezone,
                    ip_address: await getIPAddress(),
                    is_first_visit: isFirstVisit,
                    utm_source: analytics.utmParams.source,
                    utm_medium: analytics.utmParams.medium,
                    utm_campaign: analytics.utmParams.campaign,
                    utm_term: analytics.utmParams.term,
                    utm_content: analytics.utmParams.content,
                    referrer: document.referrer || '',
                    landing_page: window.location.pathname
                };
                
                // Store session data locally
                sessionStorage.setItem('current_session', JSON.stringify(sessionData));
                
                // Send to Supabase if client is available
                if (analytics.supabaseClient) {
                    const { error } = await analytics.supabaseClient
                        .from('analytics_sessions')
                        .insert([sessionData]);
                    
                    if (error) {
                        console.error('[Analytics] Error logging session:', error);
                        // Store locally for retry
                        storeFailedEvent('session', sessionData);
                    }
                }
                
                // Update active users
                updateActiveUsers();
                
            } catch (error) {
                console.error('[Analytics] Error starting session:', error);
            }
        }

        // Get user ID (from cookie or generate anonymous)
        function getUserId() {
            let userId = localStorage.getItem('gg_user_id');
            if (!userId) {
                userId = 'anon_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('gg_user_id', userId);
            }
            return userId;
        }

        // Get IP address (approximate)
        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }

        // Track page view
        async function trackPageView() {
            try {
                analytics.currentPage = window.location.href;
                analytics.pageStartTime = Date.now();
                analytics.scrollDepth = 0;
                
                const pageviewData = {
                    session_id: analytics.sessionId,
                    page_url: window.location.href,
                    page_title: document.title,
                    page_path: window.location.pathname,
                    referrer: document.referrer || '',
                    metadata: {
                        scroll_depth: 0,
                        time_on_page: 0
                    }
                };
                
                // Store pageview data
                if (analytics.supabaseClient) {
                    const { error } = await analytics.supabaseClient
                        .from('analytics_pageviews')
                        .insert([pageviewData]);
                    
                    if (error) {
                        console.error('[Analytics] Error logging pageview:', error);
                        storeFailedEvent('pageview', pageviewData);
                    }
                }
                
                // Update last activity
                analytics.lastActivity = Date.now();
                
                // Track time on page when leaving
                window.addEventListener('beforeunload', trackTimeOnPage);
                
                // Start scroll tracking
                startScrollTracking();
                
            } catch (error) {
                console.error('[Analytics] Error tracking pageview:', error);
            }
        }

        // Track time on page
        function trackTimeOnPage() {
            const timeOnPage = Math.round((Date.now() - analytics.pageStartTime) / 1000);
            
            // Store time on page data
            const timeData = {
                session_id: analytics.sessionId,
                page_url: analytics.currentPage,
                time_on_page: timeOnPage,
                scroll_depth: analytics.scrollDepth
            };
            
            // Send via Beacon API for reliability
            const blob = new Blob([JSON.stringify(timeData)], {type: 'application/json'});
            navigator.sendBeacon(`${ANALYTICS_CONFIG.supabaseUrl}/rest/v1/analytics_pageviews?select=*`, blob);
        }

        // Start scroll tracking
        function startScrollTracking() {
            let scrollTracked25 = false;
            let scrollTracked50 = false;
            let scrollTracked75 = false;
            let scrollTracked100 = false;
            
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercentage = (scrollTop / scrollHeight) * 100;
                
                analytics.scrollDepth = Math.max(analytics.scrollDepth, scrollPercentage);
                
                // Track scroll milestones
                if (scrollPercentage >= 25 && !scrollTracked25) {
                    scrollTracked25 = true;
                    trackEvent('scroll', 'page_scroll', '25%', scrollPercentage);
                }
                if (scrollPercentage >= 50 && !scrollTracked50) {
                    scrollTracked50 = true;
                    trackEvent('scroll', 'page_scroll', '50%', scrollPercentage);
                }
                if (scrollPercentage >= 75 && !scrollTracked75) {
                    scrollTracked75 = true;
                    trackEvent('scroll', 'page_scroll', '75%', scrollPercentage);
                }
                if (scrollPercentage >= 95 && !scrollTracked100) {
                    scrollTracked100 = true;
                    trackEvent('scroll', 'page_scroll', '100%', scrollPercentage);
                }
            });
        }

        // Track user events
        async function trackEvent(eventType, category, label, value = null, element = null) {
            try {
                const eventData = {
                    session_id: analytics.sessionId,
                    event_type: eventType,
                    event_category: category,
                    event_label: label,
                    event_value: value,
                    element_id: element?.id || null,
                    element_class: element?.className || null,
                    element_text: element?.textContent?.substring(0, 100) || null,
                    page_url: window.location.href,
                    metadata: {
                        timestamp: Date.now(),
                        scroll_position: window.pageYOffset
                    }
                };
                
                // Update last activity
                analytics.lastActivity = Date.now();
                
                // Send to Supabase
                if (analytics.supabaseClient) {
                    const { error } = await analytics.supabaseClient
                        .from('analytics_events')
                        .insert([eventData]);
                    
                    if (error) {
                        console.error('[Analytics] Error logging event:', error);
                        storeFailedEvent('event', eventData);
                    }
                }
                
                // Log for debugging
                if (ANALYTICS_CONFIG.debugMode) {
                    console.log(`[Analytics] Event: ${category} - ${label}`, eventData);
                }
                
            } catch (error) {
                console.error('[Analytics] Error tracking event:', error);
            }
        }

        // Track conversion
        async function trackConversion(conversionType, bookingId = null, customerEmail = null, serviceType = null, estimatedValue = null) {
            try {
                const conversionData = {
                    session_id: analytics.sessionId,
                    conversion_type: conversionType,
                    booking_id: bookingId,
                    customer_email: customerEmail,
                    service_type: serviceType,
                    estimated_value: estimatedValue,
                    pageviews_to_convert: getPageviewCount(),
                    days_to_convert: Math.round((Date.now() - analytics.sessionStartTime) / (1000 * 60 * 60 * 24)),
                    utm_source: analytics.utmParams.source,
                    utm_medium: analytics.utmParams.medium,
                    utm_campaign: analytics.utmParams.campaign
                };
                
                // Send to Supabase
                if (analytics.supabaseClient) {
                    const { error } = await analytics.supabaseClient
                        .from('analytics_conversions')
                        .insert([conversionData]);
                    
                    if (error) {
                        console.error('[Analytics] Error logging conversion:', error);
                        storeFailedEvent('conversion', conversionData);
                    }
                }
                
                // Update session as converted
                if (analytics.supabaseClient) {
                    await analytics.supabaseClient
                        .from('analytics_sessions')
                        .update({ is_converted: true, conversion_type: conversionType })
                        .eq('session_id', analytics.sessionId);
                }
                
                console.log(`[Analytics] Conversion tracked: ${conversionType}`);
                
            } catch (error) {
                console.error('[Analytics] Error tracking conversion:', error);
            }
        }

        // Get pageview count for current session
        function getPageviewCount() {
            return parseInt(sessionStorage.getItem('pageview_count') || '1');
        }

        // Update active users
        async function updateActiveUsers() {
            try {
                const activeUserData = {
                    session_id: analytics.sessionId,
                    user_id: getUserId(),
                    page_url: window.location.href,
                    last_activity: new Date().toISOString(),
                    active_duration: Math.round((Date.now() - analytics.sessionStartTime) / 1000),
                    is_mobile: analytics.deviceInfo.deviceType === 'mobile',
                    city: await getCityFromIP()
                };
                
                if (analytics.supabaseClient) {
                    const { error } = await analytics.supabaseClient
                        .from('analytics_active_users')
                        .upsert([activeUserData], { onConflict: 'session_id' });
                    
                    if (error) {
                        console.error('[Analytics] Error updating active users:', error);
                    }
                }
                
            } catch (error) {
                console.error('[Analytics] Error updating active users:', error);
            }
        }

        // Get city from IP (simplified)
        async function getCityFromIP() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                return data.city || 'Unknown';
            } catch (error) {
                return 'Unknown';
            }
        }

        // Check session timeout
        function checkSessionTimeout() {
            const inactiveTime = Date.now() - analytics.lastActivity;
            if (inactiveTime > ANALYTICS_CONFIG.sessionTimeout) {
                // Session expired, create new one
                analytics.sessionId = generateSessionId();
                startSessionTracking();
            }
        }

        // Store failed events for retry
        function storeFailedEvent(type, data) {
            try {
                const failedEvents = JSON.parse(localStorage.getItem('gg_failed_events') || '[]');
                failedEvents.push({
                    type: type,
                    data: data,
                    timestamp: Date.now()
                });
                
                // Keep only last 50 failed events
                if (failedEvents.length > 50) {
                    failedEvents.shift();
                }
                
                localStorage.setItem('gg_failed_events', JSON.stringify(failedEvents));
            } catch (error) {
                console.error('[Analytics] Error storing failed event:', error);
            }
        }

        // Retry failed events
        async function retryFailedEvents() {
            try {
                const failedEvents = JSON.parse(localStorage.getItem('gg_failed_events') || '[]');
                if (failedEvents.length === 0) return;
                
                for (const event of failedEvents) {
                    if (analytics.supabaseClient) {
                        const { error } = await analytics.supabaseClient
                            .from(`analytics_${event.type}s`)
                            .insert([event.data]);
                        
                        if (!error) {
                            // Remove successful event
                            const index = failedEvents.indexOf(event);
                            failedEvents.splice(index, 1);
                        }
                    }
                }
                
                localStorage.setItem('gg_failed_events', JSON.stringify(failedEvents));
            } catch (error) {
                console.error('[Analytics] Error retrying failed events:', error);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Track button clicks
            document.addEventListener('click', function(e) {
                const target = e.target;
                
                // Check if it's a button or link
                if (target.tagName === 'BUTTON' || target.tagName === 'A' || target.closest('button') || target.closest('a')) {
                    const button = target.tagName === 'BUTTON' || target.closest('button') ? 
                                  (target.tagName === 'BUTTON' ? target : target.closest('button')) :
                                  (target.tagName === 'A' ? target : target.closest('a'));
                    
                    const text = button.textContent.trim().substring(0, 50) || button.getAttribute('aria-label') || 'Unknown';
                    const id = button.id || 'no-id';
                    
                    trackEvent('click', 'button', text, null, button);
                    
                    // Special tracking for important buttons
                    if (button.textContent.includes('Quote') || button.textContent.includes('Get Quote') || button.textContent.includes('Free Quote')) {
                        trackEvent('click', 'conversion', 'quote_request_click', null, button);
                    }
                    if (button.textContent.includes('Book') || button.textContent.includes('Schedule') || button.textContent.includes('Appointment')) {
                        trackEvent('click', 'conversion', 'booking_click', null, button);
                    }
                    if (button.textContent.includes('WhatsApp') || button.getAttribute('href')?.includes('whatsapp')) {
                        trackEvent('click', 'messaging', 'whatsapp_click', null, button);
                    }
                }
            });
            
            // Track form submissions
            document.addEventListener('submit', function(e) {
                const form = e.target;
                trackEvent('submit', 'form', form.id || 'form_submission', null, form);
            });
            
            // Track coverage checker submissions
            document.addEventListener('click', function(e) {
                if (e.target.id === 'checkButton' || e.target.closest('#checkButton')) {
                    const postcodeInput = document.getElementById('postcodeInput');
                    if (postcodeInput && postcodeInput.value) {
                        trackEvent('submit', 'coverage_check', 'postcode_check', postcodeInput.value);
                    }
                }
            });
            
            // Track outbound links
            document.addEventListener('click', function(e) {
                const link = e.target.closest('a');
                if (link && link.href && link.hostname !== window.location.hostname) {
                    trackEvent('click', 'outbound_link', link.href, null, link);
                }
            });
            
            // Track visibility change (tab switch)
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    trackEvent('view', 'page_visibility', 'tab_hidden');
                } else {
                    trackEvent('view', 'page_visibility', 'tab_visible');
                }
            });
            
            // Track mobile menu toggle
            document.addEventListener('click', function(e) {
                if (e.target.id === 'mobileMenuBtn' || e.target.closest('#mobileMenuBtn')) {
                    trackEvent('click', 'navigation', 'mobile_menu_toggle');
                }
            });
            
            // Track video plays (if any)
            document.addEventListener('play', function(e) {
                if (e.target.tagName === 'VIDEO') {
                    trackEvent('play', 'video', e.target.src || 'video_play');
                }
            }, true);
            
            // Track newsletter signups
            const newsletterForm = document.querySelector('.newsletter-form form');
            if (newsletterForm) {
                newsletterForm.addEventListener('submit', function() {
                    trackEvent('submit', 'newsletter', 'signup');
                });
            }
        }

        // Google Analytics 4 Integration
        function initGoogleAnalytics() {
            // Add GA4 script
            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-YOUR_GA4_ID'; // Replace with your GA4 ID
            document.head.appendChild(script);
            
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-YOUR_GA4_ID'); // Replace with your GA4 ID
            
            // Enhanced ecommerce tracking for bookings
            gtag('event', 'page_view', {
                page_location: window.location.href,
                page_title: document.title
            });
        }

        // Privacy compliance (GDPR)
        function initPrivacyCompliance() {
            // Check if user has consented to tracking
            const hasConsent = localStorage.getItem('gg_analytics_consent');
            
            if (hasConsent === 'true') {
                // User has consented, initialize tracking
                initAnalytics();
                initGoogleAnalytics();
            } else if (hasConsent === 'false') {
                // User has declined, don't track
                ANALYTICS_CONFIG.trackingEnabled = false;
            } else {
                // First visit, show consent banner
                showConsentBanner();
            }
        }

        // Show consent banner
        function showConsentBanner() {
            const bannerHTML = `
                <div id="analyticsConsentBanner" style="
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    background: var(--dark-green);
                    color: white;
                    padding: 20px;
                    z-index: 9999;
                    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                ">
                    <div style="flex: 1;">
                        <h4 style="margin-bottom: 8px; font-size: 16px;">Privacy Preferences</h4>
                        <p style="font-size: 14px; opacity: 0.9;">
                            We use cookies and analytics to improve your experience on our website.
                            Your data helps us provide better cleaning services.
                        </p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="acceptAnalytics()" style="
                            padding: 10px 20px;
                            background: var(--primary-green);
                            color: white;
                            border: none;
                            border-radius: 6px;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            Accept All
                        </button>
                        <button onclick="rejectAnalytics()" style="
                            padding: 10px 20px;
                            background: transparent;
                            color: white;
                            border: 2px solid white;
                            border-radius: 6px;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            Reject All
                        </button>
                        <button onclick="showPrivacySettings()" style="
                            padding: 10px 20px;
                            background: transparent;
                            color: white;
                            border: none;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                            Settings
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', bannerHTML);
        }

        // Accept analytics
        window.acceptAnalytics = function() {
            localStorage.setItem('gg_analytics_consent', 'true');
            document.getElementById('analyticsConsentBanner').remove();
            initAnalytics();
            initGoogleAnalytics();
        };

        // Reject analytics
        window.rejectAnalytics = function() {
            localStorage.setItem('gg_analytics_consent', 'false');
            document.getElementById('analyticsConsentBanner').remove();
        };

        // Show privacy settings
        window.showPrivacySettings = function() {
            const settingsHTML = `
                <div id="privacySettings" style="
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: white;
                    padding: 30px;
                    border-radius: 12px;
                    box-shadow: var(--shadow-xl);
                    z-index: 10000;
                    max-width: 500px;
                    width: 90%;
                ">
                    <h3 style="margin-bottom: 20px; color: var(--dark-green);">Privacy Settings</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <input type="checkbox" id="essentialCookies" checked disabled style="width: 18px; height: 18px;">
                            <div>
                                <strong>Essential Cookies</strong>
                                <p style="font-size: 14px; color: var(--medium-gray); margin-top: 5px;">
                                    Required for basic site functionality. Cannot be disabled.
                                </p>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <input type="checkbox" id="analyticsCookies" checked style="width: 18px; height: 18px;">
                            <div>
                                <strong>Analytics Cookies</strong>
                                <p style="font-size: 14px; color: var(--medium-gray); margin-top: 5px;">
                                    Help us understand how visitors use our site to improve our services.
                                </p>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="marketingCookies" style="width: 18px; height: 18px;">
                            <div>
                                <strong>Marketing Cookies</strong>
                                <p style="font-size: 14px; color: var(--medium-gray); margin-top: 5px;">
                                    Used to show relevant ads and measure ad performance.
                                </p>
                            </div>
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="savePrivacySettings()" style="
                            padding: 12px 24px;
                            background: var(--primary-green);
                            color: white;
                            border: none;
                            border-radius: 6px;
                            font-weight: 600;
                            cursor: pointer;
                            flex: 1;
                        ">
                            Save Preferences
                        </button>
                        <button onclick="closePrivacySettings()" style="
                            padding: 12px 24px;
                            background: var(--light-gray);
                            color: var(--dark-gray);
                            border: none;
                            border-radius: 6px;
                            font-weight: 600;
                            cursor: pointer;
                            flex: 1;
                        ">
                            Cancel
                        </button>
                    </div>
                </div>
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.5);
                    z-index: 9999;
                "></div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', settingsHTML);
        };

        // Save privacy settings
        window.savePrivacySettings = function() {
            const analyticsEnabled = document.getElementById('analyticsCookies').checked;
            const marketingEnabled = document.getElementById('marketingCookies').checked;
            
            localStorage.setItem('gg_analytics_consent', analyticsEnabled ? 'true' : 'false');
            localStorage.setItem('gg_marketing_consent', marketingEnabled ? 'true' : 'false');
            
            closePrivacySettings();
            document.getElementById('analyticsConsentBanner')?.remove();
            
            if (analyticsEnabled) {
                initAnalytics();
                initGoogleAnalytics();
            }
        };

        // Close privacy settings
        window.closePrivacySettings = function() {
            document.getElementById('privacySettings')?.remove();
            document.querySelector('div[style*="background: rgba(0,0,0,0.5)"]')?.remove();
        };

        // Performance monitoring
        function initPerformanceMonitoring() {
            // Track Core Web Vitals
            if ('PerformanceObserver' in window) {
                // Largest Contentful Paint (LCP)
                const lcpObserver = new PerformanceObserver((entryList) => {
                    const entries = entryList.getEntries();
                    const lastEntry = entries[entries.length - 1];
                    
                    if (window.GreenGloAnalytics) {
                        window.GreenGloAnalytics.trackEvent('performance', 'web_vital', 'lcp', lastEntry.startTime);
                    }
                });
                lcpObserver.observe({ type: 'largest-contentful-paint', buffered: true });
                
                // First Input Delay (FID)
                const fidObserver = new PerformanceObserver((entryList) => {
                    const entries = entryList.getEntries();
                    entries.forEach(entry => {
                        if (window.GreenGloAnalytics) {
                            window.GreenGloAnalytics.trackEvent('performance', 'web_vital', 'fid', entry.processingStart - entry.startTime);
                        }
                    });
                });
                fidObserver.observe({ type: 'first-input', buffered: true });
                
                // Cumulative Layout Shift (CLS)
                let clsValue = 0;
                const clsObserver = new PerformanceObserver((entryList) => {
                    for (const entry of entryList.getEntries()) {
                        if (!entry.hadRecentInput) {
                            clsValue += entry.value;
                        }
                    }
                    
                    if (window.GreenGloAnalytics) {
                        window.GreenGloAnalytics.trackEvent('performance', 'web_vital', 'cls', clsValue);
                    }
                });
                clsObserver.observe({ type: 'layout-shift', buffered: true });
            }
            
            // Track page load metrics
            window.addEventListener('load', function() {
                setTimeout(() => {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    if (perfData) {
                        const metrics = {
                            dns: perfData.domainLookupEnd - perfData.domainLookupStart,
                            tcp: perfData.connectEnd - perfData.connectStart,
                            ttfb: perfData.responseStart - perfData.requestStart,
                            domLoad: perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart,
                            pageLoad: perfData.loadEventEnd - perfData.loadEventStart
                        };
                        
                        if (window.GreenGloAnalytics) {
                            window.GreenGloAnalytics.trackEvent('performance', 'page_load', 'timing', metrics.pageLoad);
                        }
                    }
                }, 0);
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Start privacy compliance check
            initPrivacyCompliance();
            
            // Retry failed events every 5 minutes
            setInterval(retryFailedEvents, 5 * 60 * 1000);
            
            // Update active users every minute
            setInterval(updateActiveUsers, 60 * 1000);
            
            // Track page load time
            window.addEventListener('load', function() {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                trackEvent('performance', 'page_load', 'complete', loadTime);
            });
            
            // Track service area checker specifically
            const postcodeForm = document.getElementById('postcodeForm');
            if (postcodeForm) {
                postcodeForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const postcode = document.getElementById('postcodeInput').value;
                    if (postcode) {
                        // Track search term
                        trackEvent('search', 'postcode_check', postcode);
                        
                        // Store in analytics_search_terms
                        if (analytics.supabaseClient) {
                            analytics.supabaseClient
                                .from('analytics_search_terms')
                                .upsert({
                                    search_term: postcode,
                                    postcode_area: postcode.split(' ')[0],
                                    last_searched_at: new Date().toISOString()
                                }, { onConflict: 'search_term' })
                                .then(({ error }) => {
                                    if (error) console.error('Error saving search term:', error);
                                });
                        }
                    }
                });
            }
            
            // Track WhatsApp conversions
            const whatsappButtons = document.querySelectorAll('a[href*="whatsapp"], button[onclick*="whatsapp"]');
            whatsappButtons.forEach(button => {
                button.addEventListener('click', function() {
                    trackEvent('click', 'messaging', 'whatsapp_conversion');
                    trackConversion('whatsapp_contact');
                });
            });

            // Initialize performance monitoring
            initPerformanceMonitoring();
        });

        // Make tracking functions available globally
        window.GreenGloAnalytics = {
            trackEvent: trackEvent,
            trackConversion: trackConversion,
            getSessionId: () => analytics.sessionId,
            getDeviceInfo: () => analytics.deviceInfo
        };

        // Debug mode
        if (ANALYTICS_CONFIG.debugMode) {
            console.log('[Analytics] Debug mode enabled');
            window.analyticsDebug = analytics;
        }
    </script>

    <!-- Your existing CSS styles remain here -->
    <style>
        /* ===== CSS Reset & Variables ===== */
        :root {
            /* Modern Green Palette */
            --primary-green: #10B981;
            --secondary-green: #34D399;
            --dark-green: #065F46;
            --light-green: #D1FAE5;
            --accent-green: #059669;
            --emerald: #10B981;
            --teal: #0D9488;
            --mint: #A7F3D0;

            /* Neutrals */
            --white: #FFFFFF;
            --off-white: #F9FAFB;
            --light-gray: #F3F4F6;
            --medium-gray: #9CA3AF;
            --dark-gray: #4B5563;
            --black: #111827;

            /* Accents */
            --gold: #FBBF24;
            --shadow: 0 20px 40px rgba(16, 185, 129, 0.12);
            --shadow-lg: 0 25px 50px rgba(16, 185, 129, 0.15);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 16px;
            --border-radius-lg: 24px;
            --gradient-primary: linear-gradient(135deg, var(--primary-green), var(--teal));
            --gradient-dark: linear-gradient(135deg, var(--dark-green), var(--teal));
        }

        /* ... rest of your CSS styles remain unchanged ... */
    </style>
</head>

<body>
    <!-- Your HTML body content remains exactly the same -->
    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>

    <!-- Premium Navigation Bar -->
    <nav class="navbar" id="navbar">
        <!-- ... navigation content ... -->
    </nav>

    <!-- Premium Hero Section -->
    <section class="hero" id="home">
        <!-- ... hero content ... -->
    </section>

    <!-- Features Section -->
    <section class="section section-light" id="sustainability">
        <!-- ... features content ... -->
    </section>

    <!-- Testimonials Carousel Section -->
    <section class="section section-gray" id="testimonials">
        <!-- ... testimonials content ... -->
    </section>

    <!-- GreenGlo Club Section -->
    <section class="section section-light" id="club">
        <!-- ... club content ... -->
    </section>

    <!-- FAQ Section -->
    <section class="section section-gray" id="faq">
        <!-- ... FAQ content ... -->
    </section>

    <!-- Service Coverage Checker & Map Section -->
    <section class="section section-light" id="coverage-checker">
        <!-- ... coverage checker content ... -->
    </section>

    <!-- CTA Section -->
    <section class="section" id="contact">
        <!-- ... CTA content ... -->
    </section>

    <!-- Floating WhatsApp Button -->
    <div class="whatsapp-float">
        <!-- ... WhatsApp button content ... -->
    </div>

    <!-- Footer -->
    <footer class="footer">
        <!-- ... footer content ... -->
    </footer>

    <!-- JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script>
        // ===== Mobile Navigation =====
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileCloseBtn = document.getElementById('mobileCloseBtn');
        const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
        const navMenu = document.getElementById('navMenu');
        const navbar = document.getElementById('navbar');
        const navLinks = document.querySelectorAll('.nav-link');

        // Function to open mobile menu
        const openMobileMenu = () => {
            navMenu.classList.add('active');
            mobileMenuOverlay.classList.add('active');
            mobileMenuBtn.classList.add('active');
            mobileMenuBtn.innerHTML = '<i class="fas fa-times"></i>';
            document.body.style.overflow = 'hidden';
        };

        // Function to close mobile menu
        const closeMobileMenu = () => {
            navMenu.classList.remove('active');
            mobileMenuOverlay.classList.remove('active');
            mobileMenuBtn.classList.remove('active');
            mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
            document.body.style.overflow = '';
        };

        // Toggle Mobile Menu
        mobileMenuBtn.addEventListener('click', () => {
            if (navMenu.classList.contains('active')) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        });

        // Close Mobile Menu with Close Button
        mobileCloseBtn.addEventListener('click', closeMobileMenu);

        // Close Mobile Menu with Overlay Click
        mobileMenuOverlay.addEventListener('click', closeMobileMenu);

        // Close Mobile Menu on Link Click
        navLinks.forEach(link => {
            link.addEventListener('click', closeMobileMenu);
        });

        // Close menu on Escape key press
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && navMenu.classList.contains('active')) {
                closeMobileMenu();
            }
        });

        // Navbar Scroll Effect
        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // ===== Testimonial Carousel =====
        const carouselContainer = document.getElementById('carouselContainer');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const indicators = document.querySelectorAll('.carousel-indicator');
        const totalSlides = document.querySelectorAll('.testimonial-card').length;
        let currentSlide = 0;

        // Function to update carousel position
        function updateCarousel() {
            carouselContainer.style.transform = `translateX(-${currentSlide * 100}%)`;

            // Update indicators
            indicators.forEach((indicator, index) => {
                if (index === currentSlide) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
        }

        // Next slide function
        function nextSlide() {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateCarousel();
        }

        // Previous slide function
        function prevSlide() {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            updateCarousel();
        }

        // Add click events to buttons
        prevBtn.addEventListener('click', prevSlide);
        nextBtn.addEventListener('click', nextSlide);

        // Add click events to indicators
        indicators.forEach((indicator, index) => {
            indicator.addEventListener('click', () => {
                currentSlide = index;
                updateCarousel();
            });
        });

        // Auto-rotate carousel every 5 seconds
        let carouselInterval = setInterval(nextSlide, 5000);

        // Pause auto-rotation on hover
        const carousel = document.querySelector('.testimonials-carousel');
        carousel.addEventListener('mouseenter', () => {
            clearInterval(carouselInterval);
        });

        carousel.addEventListener('mouseleave', () => {
            clearInterval(carouselInterval);
            carouselInterval = setInterval(nextSlide, 5000);
        });

        // ===== FAQ Accordion =====
        const faqItems = document.querySelectorAll('.faq-item');
        
        faqItems.forEach(item => {
            const question = item.querySelector('.faq-question');
            
            question.addEventListener('click', () => {
                // Close all other FAQs
                faqItems.forEach(otherItem => {
                    if (otherItem !== item && otherItem.classList.contains('active')) {
                        otherItem.classList.remove('active');
                    }
                });
                
                // Toggle current FAQ
                item.classList.toggle('active');
            });
        });

        // ===== Animated Counter =====
        const counters = document.querySelectorAll('[data-count]');
        const speed = 200;

        const animateCounter = () => {
            counters.forEach(counter => {
                const target = +counter.getAttribute('data-count');
                const count = +counter.innerText.replace('+', '');

                if (count < target) {
                    counter.innerText = Math.ceil(count + target / speed) + '+';
                    setTimeout(animateCounter, 1);
                } else {
                    counter.innerText = target + '+';
                }
            });
        };

        // Trigger counter when in viewport
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animateCounter();
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });

        counters.forEach(counter => observer.observe(counter.parentElement));

        // ===== Smooth Scrolling =====
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                if (this.getAttribute('href') === '#') return;

                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);

                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // ===== Add Loading Animation to Elements =====
        const animatedElements = document.querySelectorAll('.feature-card, .service-card, .testimonial-card');
        animatedElements.forEach((el, index) => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        });

        const elementObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1 });

        animatedElements.forEach(el => elementObserver.observe(el));

        // ===== Coverage Checker & Map Functionality =====
        const serviceConfig = {
            // Define covered postcode areas (first part of UK postcode)
            coveredAreas: [
                // London Postal Districts
                'E', 'EC', 'N', 'NW', 'SE', 'SW', 'W', 'WC',
                // Kent Postal Districts (e.g., ME, TN, CT)
                'ME', 'TN', 'CT', 'DA',
                // Essex Postal Districts
                'IG', 'RM', 'CM', 'SS', 'CO'
            ],
            companyName: 'GreenGlo Cleaners',
            phoneNumber: '447827784204'
        };

        // DOM Elements for Coverage Checker
        const postcodeForm = document.getElementById('postcodeForm');
        const postcodeInput = document.getElementById('postcodeInput');
        const coverageResult = document.getElementById('coverageResult');
        const checkButton = document.getElementById('checkButton');

        // Initialize the Map
        let serviceMap = null;
        let coverageLayer = null;
        
        function initServiceMap() {
            // Center map on South East England
            serviceMap = L.map('serviceAreaMap').setView([51.507, 0.127], 9);
            
            // Add tile layer (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                maxZoom: 13,
                minZoom: 7
            }).addTo(serviceMap);
            
            // Define a rough polygon for the service area (London, Kent, Essex)
            const serviceAreaCoords = [
                [51.686, 0.010],  // NE Essex
                [51.686, 0.800],  // NW Essex/Kent
                [51.200, 0.800],  // SW Kent
                [51.200, -0.510], // SW London
                [51.686, -0.510], // NW London
                [51.686, 0.010]   // Close polygon
            ];
            
            // Add the service area polygon to the map
            coverageLayer = L.polygon(serviceAreaCoords, {
                color: 'var(--primary-green)',
                weight: 2,
                fillColor: 'rgba(16, 185, 129, 0.3)',
                fillOpacity: 0.4,
                className: 'service-coverage-layer'
            }).addTo(serviceMap);
            
            // Add a marker for central London
            L.marker([51.507, -0.127])
                .addTo(serviceMap)
                .bindPopup('<b>GreenGlo Cleaners</b><br>London Headquarters')
                .openPopup();
        }

        // UK Postcode Validation & Parser
        function validateAndParsePostcode(postcode) {
            // Clean and standardize input
            let cleanPostcode = postcode.toUpperCase().replace(/\s+/g, '').trim();
            
            // Basic UK postcode regex (covers most formats)
            const postcodeRegex = /^([A-Z]{1,2}\d{1,2}[A-Z]?)\d[A-Z]{2}$/;
            
            if (!postcodeRegex.test(cleanPostcode)) {
                // Also try to match just the outcode (first part)
                const outcodeRegex = /^([A-Z]{1,2}\d{1,2}[A-Z]?)/;
                const match = cleanPostcode.match(outcodeRegex);
                if (match) {
                    return { valid: true, fullPostcode: null, outcode: match[1] };
                }
                return { valid: false, error: 'Please enter a valid UK postcode format (e.g., SW1A 1AA or ME14 2TT).' };
            }
            
            // Extract outcode (first part before the digit)
            const outcodeMatch = cleanPostcode.match(/^[A-Z]{1,2}\d{1,2}[A-Z]?/);
            const outcode = outcodeMatch ? outcodeMatch[0] : null;
            
            return {
                valid: true,
                fullPostcode: cleanPostcode.replace(/(.{3})$/, ' $1'), // Add space for display
                outcode: outcode
            };
        }

        // Check if Postcode is in Service Area
        function checkServiceCoverage(postcodeData) {
            const outcode = postcodeData.outcode;
            if (!outcode) return false;
            
            // Find matching service area
            for (const area of serviceConfig.coveredAreas) {
                if (outcode.startsWith(area)) {
                    return {
                        covered: true,
                        area: area,
                        region: getRegionName(area)
                    };
                }
            }
            return { covered: false };
        }
        
        // Get region name from postcode area
        function getRegionName(area) {
            const londonAreas = ['E', 'EC', 'N', 'NW', 'SE', 'SW', 'W', 'WC'];
            const kentAreas = ['ME', 'TN', 'CT', 'DA'];
            const essexAreas = ['IG', 'RM', 'CM', 'SS', 'CO'];
            
            if (londonAreas.includes(area)) return 'London';
            if (kentAreas.includes(area)) return 'Kent';
            if (essexAreas.includes(area)) return 'Essex';
            return area;
        }

        // Display Results
        function displayCoverageResult(postcodeData, coverageInfo) {
            if (coverageInfo.covered) {
                coverageResult.innerHTML = `
                    <div class="result-success">
                        <i class="fas fa-check-circle"></i>
                        <h4>Great News! We Cover Your Area</h4>
                        <div class="postcode-display">${postcodeData.fullPostcode || postcodeData.outcode}</div>
                        <p>Your postcode is in our <strong>${coverageInfo.region}</strong> service area.</p>
                        <p style="font-size: 0.95rem; color: var(--medium-gray);">
                            <i class="fas fa-clock"></i> Next available slots in ${coverageInfo.region}
                        </p>
                        <div class="result-cta">
                            <a href="https://api.whatsapp.com/send?phone=${serviceConfig.phoneNumber}&text=Hello%20GreenGlo,%20I'm%20in%20${encodeURIComponent(postcodeData.outcode)}%20and%20would%20like%20a%20quote" 
                               class="btn" 
                               target="_blank" 
                               style="margin-top: 1rem;">
                                <i class="fas fa-whatsapp"></i> Get a Quote for ${postcodeData.outcode}
                            </a>
                        </div>
                    </div>
                `;
                coverageResult.style.borderColor = 'var(--primary-green)';
                coverageResult.style.background = 'rgba(16, 185, 129, 0.05)';
            } else {
                coverageResult.innerHTML = `
                    <div class="result-error">
                        <i class="fas fa-times-circle"></i>
                        <h4>Currently Not in Your Area</h4>
                        <div class="postcode-display">${postcodeData.fullPostcode || postcodeData.outcode}</div>
                        <p>We don't currently serve <strong>${postcodeData.outcode}</strong>. Our primary areas are London, Kent & Essex.</p>
                        <p style="font-size: 0.95rem; color: var(--medium-gray);">
                            <i class="fas fa-info-circle"></i> Service areas expanding soon!
                        </p>
                        <div class="result-cta">
                            <button class="btn btn-outline" onclick="document.getElementById('postcodeInput').focus()" style="margin-top: 1rem;">
                                <i class="fas fa-redo"></i> Check Another Postcode
                            </button>
                        </div>
                    </div>
                `;
                coverageResult.style.borderColor = '#EF4444';
                coverageResult.style.background = 'rgba(239, 68, 68, 0.05)';
            }
        }

        // Form Submission Handler - WITH ANALYTICS TRACKING
        postcodeForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const postcode = postcodeInput.value.trim();
            if (!postcode) {
                postcodeInput.focus();
                return;
            }
            
            // Track coverage check with analytics
            if (window.GreenGloAnalytics) {
                window.GreenGloAnalytics.trackEvent('search', 'coverage_check', postcode);
            }
            
            // Disable button during processing
            const originalBtnText = checkButton.innerHTML;
            checkButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking...';
            checkButton.disabled = true;
            
            // Simulate API call delay
            setTimeout(() => {
                // Validate postcode
                const postcodeData = validateAndParsePostcode(postcode);
                
                if (!postcodeData.valid) {
                    coverageResult.innerHTML = `
                        <div class="result-error">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h4>Invalid Postcode</h4>
                            <p>${postcodeData.error}</p>
                            <p style="font-size: 0.9rem;">Examples: SW1A 1AA (London), ME14 2TT (Kent), CM1 1AA (Essex)</p>
                        </div>
                    `;
                    coverageResult.style.borderColor = '#F59E0B';
                    coverageResult.style.background = 'rgba(245, 158, 11, 0.05)';
                } else {
                    // Check coverage
                    const coverageInfo = checkServiceCoverage(postcodeData);
                    displayCoverageResult(postcodeData, coverageInfo);
                    
                    // Track successful coverage check
                    if (window.GreenGloAnalytics && coverageInfo.covered) {
                        window.GreenGloAnalytics.trackEvent('search', 'coverage_result', 'covered', coverageInfo.region);
                    }
                    
                    // Zoom map to approximate area if covered
                    if (coverageInfo.covered && serviceMap) {
                        const regions = {
                            'London': { center: [51.507, -0.127], zoom: 10 },
                            'Kent': { center: [51.278, 0.527], zoom: 9 },
                            'Essex': { center: [51.759, 0.457], zoom: 9 }
                        };
                        
                        if (regions[coverageInfo.region]) {
                            const { center, zoom } = regions[coverageInfo.region];
                            serviceMap.setView(center, zoom);
                        }
                    }
                }
                
                // Re-enable button
                checkButton.innerHTML = originalBtnText;
                checkButton.disabled = false;
            }, 800); // Simulated delay
        });

        // Initialize Coverage Checker when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initServiceMap();
            
            // Example postcodes for placeholder
            const examples = ['SW1A 1AA', 'ME14 2TT', 'IG1 1AA'];
            let exampleIndex = 0;
            
            // Optional: Cycle example postcodes in placeholder
            setInterval(() => {
                postcodeInput.placeholder = `e.g., ${examples[exampleIndex]}`;
                exampleIndex = (exampleIndex + 1) % examples.length;
            }, 3000);
        });

        // ===== WhatsApp Floating Button - WITH ANALYTICS TRACKING =====
        const whatsappConfig = {
            phoneNumber: "447827784204",
            companyName: "Green Glo Cleaning Co",
            defaultMessage: "Hello, I'm interested in your professional cleaning services. Could you provide more information?"
        };

        // DOM Elements for WhatsApp
        const whatsappButton = document.getElementById('whatsappButton');
        const whatsappBubble = document.getElementById('whatsappBubble');
        const whatsappNotification = document.getElementById('whatsappNotification');
        const whatsappMessageInput = document.getElementById('whatsappMessage');
        const statusText = document.getElementById('statusText');

        // Toggle message bubble
        function toggleBubble() {
            whatsappBubble.classList.contains('active') ? closeBubble() : openBubble();
        }

        function openBubble() {
            whatsappBubble.classList.add('active');
            whatsappMessageInput.focus();
            whatsappNotification.style.display = 'none';
            localStorage.setItem('whatsappNotificationRead', 'true');
        }

        function closeBubble() {
            whatsappBubble.classList.remove('active');
        }

        // Send WhatsApp message using your specific link format - WITH ANALYTICS TRACKING
        function sendWhatsAppMessage() {
            let message = whatsappMessageInput.value.trim();
            if (!message) message = whatsappConfig.defaultMessage;

            // Track WhatsApp conversion with analytics
            if (window.GreenGloAnalytics) {
                window.GreenGloAnalytics.trackEvent('click', 'messaging', 'whatsapp_message_sent', message.length);
                window.GreenGloAnalytics.trackConversion('whatsapp_message', null, null, 'general_inquiry');
            }

            // Construct the URL using your exact WhatsApp API link format
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://api.whatsapp.com/send?phone=447827784204&text=${encodedMessage}`;

            // Open the chat in a new tab
            window.open(whatsappUrl, '_blank');

            // Close bubble and reset
            closeBubble();
            whatsappMessageInput.value = '';

            // Optional: Track the event (for analytics)
            console.log('WhatsApp message initiated for:', whatsappConfig.companyName);
        }

        // Manage notifications
        function checkNotificationStatus() {
            const notificationRead = localStorage.getItem('whatsappNotificationRead');
            const lastVisit = localStorage.getItem('lastWhatsAppVisit');
            const now = new Date().getTime();

            if (!notificationRead || !lastVisit || (now - parseInt(lastVisit) > 24 * 60 * 60 * 1000)) {
                whatsappNotification.style.display = 'flex';
            } else {
                whatsappNotification.style.display = 'none';
            }
            localStorage.setItem('lastWhatsAppVisit', now.toString());
        }

        // Update status based on working hours
        function updateWorkingStatus() {
            const now = new Date();
            const day = now.getDay(); // 0 = Sunday
            const hour = now.getHours();

            // Set working hours: Mon-Fri 8am-8pm, Sat 9am-6pm
            const isWorkingHours = (
                (day >= 1 && day <= 5 && hour >= 8 && hour < 20) ||
                (day === 6 && hour >= 9 && hour < 18)
            );

            if (statusText) {
                statusText.textContent = isWorkingHours
                    ? "Typically replies instantly  Follow @greenglocleaningco"
                    : "Will reply during working hours  Follow @greenglocleaningco";
                statusText.style.color = isWorkingHours ? "#25D366" : "#FF9800";
            }
        }

        // Close bubble when clicking outside
        document.addEventListener('click', function (event) {
            if (!whatsappButton.contains(event.target) &&
                !whatsappBubble.contains(event.target) &&
                whatsappBubble.classList.contains('active')) {
                closeBubble();
            }
        });

        // Send message on Enter key
        if (whatsappMessageInput) {
            whatsappMessageInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendWhatsAppMessage();
                }
            });
        }

        // Initialize WhatsApp functionality
        checkNotificationStatus();
        updateWorkingStatus();

        // Update status every minute
        setInterval(updateWorkingStatus, 60000);

        // ===== ADDITIONAL ANALYTICS TRACKING FOR SPECIFIC ELEMENTS =====
        
        // Track all booking/quote buttons
        document.querySelectorAll('a[href*="whatsapp"], .btn[href*="whatsapp"]').forEach(button => {
            button.addEventListener('click', function() {
                if (window.GreenGloAnalytics) {
                    const buttonText = this.textContent.trim() || 'WhatsApp Button';
                    window.GreenGloAnalytics.trackEvent('click', 'conversion', buttonText);
                    
                    if (buttonText.includes('Quote') || buttonText.includes('quote')) {
                        window.GreenGloAnalytics.trackConversion('quote_request');
                    } else if (buttonText.includes('Book') || buttonText.includes('book')) {
                        window.GreenGloAnalytics.trackConversion('booking_attempt');
                    }
                }
            });
        });

        // Enhanced navigation tracking
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                if (window.GreenGloAnalytics) {
                    const linkText = this.textContent.trim();
                    const linkHref = this.getAttribute('href');
                    window.GreenGloAnalytics.trackEvent('click', 'navigation', linkText, null, this);
                }
                
                // Your existing closeMobileMenu() call
                closeMobileMenu();
            });
        });
    </script>
</body>
</html>
